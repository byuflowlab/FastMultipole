@testset "Lamb-Helmholtz transform: multipole" begin

weights_1 = ComplexF64[0.0 + 0.0im, 0.004853626716970756 + 0.000741249316661101im, 0.005345224838248485 + 8.673617379884035e-19im, -0.004853626716970757 + 0.0007412493166611006im, 2.637362637362637e-5 - 5.242432052897555e-5im, -0.0001964310689151919 - 9.377074745712207e-5im, -0.0002571428571428571 - 5.278249527359715e-20im, 0.00019643106891519197 - 9.377074745712208e-5im, 2.6373626373626394e-5 + 5.242432052897558e-5im, -2.803026575362035e-7 - 2.776630338646738e-7im, -1.5455629511693776e-6 + 2.1291208791208793e-6im, 3.502783158752621e-6 + 3.5602028191300153e-6im, 5.3261347495404564e-6 + 1.3975654187881809e-21im, -3.502783158752623e-6 + 3.5602028191300174e-6im, -1.5455629511693787e-6 - 2.129120879120881e-6im, 2.803026575362035e-7 - 2.7766303386467374e-7im, -1.676971380268084e-9 + 8.636288356050047e-10im, 1.122242641028281e-8 + 1.3968916931301184e-8im, 4.2042124542124565e-8 - 3.887280499354429e-8im, -3.38843593878706e-8 - 7.085964828089074e-8im, -5.7857142857142853e-8 - 2.002176195084779e-23im, 3.388435938787066e-8 - 7.08596482808908e-8im, 4.204212454212457e-8 + 3.8872804993544326e-8im, -1.1222426410282804e-8 + 1.396891693130118e-8im, -1.676971380268087e-9 - 8.636288356050057e-10im, 1.1295031251157756e-12 + 6.954331314268595e-12im, 8.004470878224041e-11 - 3.270934803901838e-11im, -2.0268991624876465e-10 - 3.3608502446172777e-10im, -7.018486264371405e-10 + 4.0232426303854863e-10im, 1.506976805414566e-10 + 8.672455224330058e-10im, 2.4483038768048863e-10 + 1.8829974562815519e-25im, -1.5069768054145755e-10 + 8.67245522433007e-10im, -7.018486264371402e-10 - 4.02324263038549e-10im, 2.0268991624876447e-10 - 3.3608502446172756e-10im, 8.00447087822405e-11 + 3.270934803901842e-11im, -1.1295031251157832e-12 + 6.9543313142686e-12im, 2.1399069042124594e-14 + 3.311844136157406e-15im, -2.9038388219685237e-14 - 3.238843789500636e-13im, -1.836335845572785e-12 + 5.413595513633643e-13im, 2.0810785304873766e-12 + 5.109376638592403e-12im, 7.961527337256209e-12 - 2.2630565721072572e-12im, 4.694871651326873e-13 - 6.6716330900816025e-12im, 2.249344023323624e-12 - 1.6343127024449657e-27im, -4.694871651326781e-13 - 6.671633090081617e-12im, 7.961527337256199e-12 + 2.263056572107257e-12im, -2.0810785304873742e-12 + 5.1093766385924e-12im, -1.8363358455727862e-12 - 5.413595513633651e-13im, 2.903838821968549e-14 - 3.238843789500638e-13im, 2.1399069042124613e-14 - 3.311844136157427e-15im, 2.5544666675467423e-17 - 5.052486776242658e-17im, -9.816630885488161e-16 - 2.134697993601289e-16im, 6.000291729756716e-17 + 7.268762276129868e-15im, 2.6819655234506674e-14 - 4.614717149891795e-15im, -1.1556063053640601e-14 - 5.4491967051390314e-14im, -6.337314566332784e-14 + 1.39663364200988e-15im, -1.1947942507408434e-14 + 2.6265209788956208e-14im, -4.766894983767256e-14 + 1.9402200125597726e-29im, 1.1947942507408373e-14 + 2.6265209788956388e-14im, -6.337314566332768e-14 - 1.3966336420098441e-15im, 1.1556063053640583e-14 - 5.449196705139028e-14im, 2.6819655234506674e-14 + 4.614717149891805e-15im, -6.000291729757105e-17 + 7.268762276129873e-15im, -9.816630885488175e-16 + 2.1346979936012978e-16im, -2.554466667546742e-17 - 5.052486776242653e-17im, -9.138904495260911e-20 - 9.089089207921361e-20im, -1.3118250913989989e-18 + 2.287791124653698e-18im, 2.1742591097603794e-17 + 6.294279193056512e-18im, 8.738619212858955e-18 - 1.0425654753744926e-16im, -2.778793626649212e-16 + 1.0414918301572805e-17im, 3.526237797995937e-18 + 4.255547591839573e-16im, 3.4061823844493696e-16 + 9.34511526776169e-17im, 8.159870458321392e-17 + 6.445239789141035e-17im, 4.1746874442196936e-16 - 2.627656480266976e-31im, -8.159870458321378e-17 + 6.445239789140853e-17im, 3.4061823844493553e-16 - 9.345115267761743e-17im, -3.5262377979958816e-18 + 4.255547591839572e-16im, -2.7787936266492104e-16 - 1.0414918301572873e-17im, -8.738619212858918e-18 - 1.0425654753744927e-16im, 2.1742591097603828e-17 - 6.2942791930565295e-18im, 1.311825091398998e-18 + 2.287791124653696e-18im, -9.138904495260921e-20 + 9.089089207921357e-20im, -2.3135736144402987e-22 + 1.1856325354635075e-22im, 4.069259339575609e-21 + 4.4409446148987316e-21im, 3.270754458978487e-20 - 5.0073200447775726e-20im, -3.0859383836283595e-19 - 1.1523818821643916e-19im, -2.0264028607094558e-19 + 1.0671772049221168e-18im, 2.1464875362488662e-18 + 2.470316977428545e-19im, 5.532583196398644e-19 - 2.430778155945271e-18im, -9.295668144756299e-19 - 8.78526689136094e-19im, -1.9902682039352628e-19 - 1.8114538936440715e-18im, -2.122572734643972e-18 + 3.0530061781381144e-33im, 1.990268203935278e-19 - 1.811453893644054e-18im, -9.295668144756183e-19 + 8.78526689136099e-19im, -5.532583196398642e-19 - 2.4307781559452702e-18im, 2.1464875362488635e-18 - 2.470316977428539e-19im, 2.026402860709452e-19 + 1.067177204922117e-18im, -3.0859383836283653e-19 + 1.1523818821643938e-19im, -3.270754458978483e-20 - 5.007320044777568e-20im, 4.069259339575612e-21 - 4.440944614898736e-21im, 2.3135736144402935e-22 + 1.1856325354635026e-22im, 7.454683510631029e-26 + 4.648505838177157e-25im, 1.1061694214522219e-23 - 5.1004857979008056e-24im, -8.753339297515538e-23 - 1.058338722010314e-22im, -5.265830600018081e-22 + 7.032890817269261e-22im, 3.1376317109106373e-21 + 1.4849369596624433e-21im, 2.5971574255321017e-21 - 8.223158671488948e-21im, -1.2544720299389355e-20 - 3.762053921948129e-21im, -5.479571164255033e-21 + 9.38633675611985e-21im, -2.9200923649607516e-21 + 3.98967338939298e-21im, -1.257577066187881e-21 + 1.4459873316306023e-20im, 4.41631307028768e-21 - 2.901107516208298e-35im, 1.2575770661878492e-21 + 1.4459873316305873e-20im, -2.9200923649608235e-21 - 3.98967338939302e-21im, 5.479571164255032e-21 + 9.386336756119852e-21im, -1.2544720299389317e-20 + 3.762053921948127e-21im, -2.5971574255320984e-21 - 8.223158671488948e-21im, 3.137631710910643e-21 - 1.484936959662444e-21im, 5.265830600018074e-22 + 7.032890817269255e-22im, -8.753339297515545e-23 + 1.058338722010316e-22im, -1.1061694214522196e-23 - 5.10048579790079e-24im, 7.454683510631195e-26 - 4.648505838177176e-25im]
weights_2 = ComplexF64[0.0 + 0.0im, 0.0 - 0.4818120558297157im, 0.26726124191242456 + 0.0im, 0.0 - 0.4818120558297158im, -0.004107142857142856 - 0.0013363062095621222im, 0.0007412493166611018 + 0.01832491719672632im, -0.01964285714285715 - 8.673617379884035e-19im, -0.0007412493166611016 + 0.018324917196726326im, -0.004107142857142856 + 0.0013363062095621226im, -1.518821965854794e-5 + 2.08696980226608e-5im, 0.00017137025786362594 + 5.109890109890111e-5im, -4.820608848147832e-5 - 0.0002688352432390528im, 0.0005828840418851925 + 3.7535902223019745e-20im, 4.820608848147825e-5 - 0.00026883524323905307im, 0.000171370257863626 - 5.109890109890115e-5im, 1.5188219658547952e-5 + 2.0869698022660797e-5im, 6.788821297749878e-8 + 9.367604426921294e-8im, 6.381056960872425e-7 - 9.105448349585126e-7im, -3.1636904761904753e-6 - 7.46104300338851e-7im, 1.3682226970036185e-6 + 9.992032552539199e-7im, -9.751488095238098e-6 - 6.120231844161016e-22im, -1.3682226970036161e-6 + 9.992032552539256e-7im, -3.163690476190476e-6 + 7.461043003388518e-7im, -6.381056960872426e-7 - 9.105448349585122e-7im, 6.788821297749879e-8 - 9.367604426921305e-8im, 3.947268076095154e-10 - 1.275573805275341e-10im, -3.049992651183417e-9 - 4.087232822122936e-9im, -1.1949203010390831e-8 + 1.8384969754578814e-8im, 3.1551441302222746e-8 + 2.4561747776033298e-9im, -2.3016756356464765e-8 + 2.7381882123410687e-8im, 1.0196652715249258e-7 + 5.980818387393068e-24im, 2.3016756356464722e-8 + 2.738188212341057e-8im, 3.1551441302222746e-8 - 2.456174777603328e-9im, 1.1949203010390828e-8 + 1.83849697545788e-8im, -3.0499926511834185e-9 + 4.087232822122941e-9im, -3.947268076095162e-10 - 1.275573805275343e-10im, 2.4764149813205593e-15 - 1.2395255829130878e-12im, -1.759826556435851e-11 + 5.910505283256045e-12im, 6.492000627033013e-11 + 8.271713741869419e-11im, 1.2316122289842024e-10 - 2.2234391713101542e-10im, -1.3316179551032817e-10 + 8.797866381867903e-11im, 2.566224884120808e-10 - 5.52124044393729e-10im, -6.46606434240362e-10 - 5.52686547484526e-26im, -2.566224884120804e-10 - 5.521240443937275e-10im, -1.3316179551032786e-10 - 8.797866381867923e-11im, -1.2316122289842013e-10 - 2.2234391713101518e-10im, 6.492000627033021e-11 - 8.271713741869429e-11im, 1.7598265564358535e-11 + 5.910505283256053e-12im, 2.476414981320906e-15 + 1.2395255829130892e-12im, -3.01694366022282e-15 - 9.882672259531884e-16im, 4.328410688812105e-16 + 5.606337489386253e-14im, 3.7082685650755544e-13 - 1.3221074267339063e-13im, -8.617472628614382e-13 - 1.0064454022964915e-12im, -5.876475191886059e-13 + 1.6984179836239904e-12im, -8.653387076277016e-13 - 1.7909306062822884e-12im, -1.9562139497896878e-12 + 5.36154980774496e-12im, 1.4931243003490293e-12 + 6.72931636013387e-28im, 1.9562139497896878e-12 + 5.361549807744946e-12im, -8.653387076277097e-13 + 1.790930606282292e-12im, 5.876475191886048e-13 + 1.6984179836239875e-12im, -8.617472628614393e-13 + 1.0064454022964925e-12im, -3.7082685650755584e-13 - 1.3221074267339076e-13im, 4.328410688811711e-16 - 5.606337489386262e-14im, 3.0169436602228096e-15 - 9.882672259531898e-16im, -4.197962217417128e-18 + 5.744143821118435e-18im, 1.379183414421988e-16 + 4.389335661043189e-17im, -2.7248116118126898e-17 - 1.2119533619562529e-15im, -4.853087712235235e-15 + 1.893855968754816e-15im, 7.855160963037513e-15 + 7.7835139582938e-15im, -2.4302086212900463e-15 - 7.0765931371125225e-15im, 1.9300117978575606e-14 + 1.8730669812099825e-14im, 9.582116180884521e-15 - 3.111021814989741e-14im, 1.590541386964493e-14 - 8.35124443807026e-30im, -9.58211618088453e-15 - 3.1110218149897315e-14im, 1.9300117978575694e-14 - 1.8730669812099882e-14im, 2.4302086212900475e-15 - 7.076593137112501e-15im, 7.85516096303753e-15 - 7.783513958293808e-15im, 4.8530877122352395e-15 + 1.8938559687548177e-15im, -2.7248116118125755e-17 + 1.2119533619562552e-15im, -1.3791834144219842e-16 + 4.389335661043192e-17im, -4.1979622174171225e-18 - 5.7441438211184344e-18im, 8.293808559254514e-21 + 1.1492524380320382e-20im, 1.9059010572119847e-19 - 2.6491003142494882e-19im, -3.036337844199795e-18 - 9.255592622309865e-19im, 7.402087495423991e-19 + 1.6550320540084803e-17im, 4.324757043300415e-17 - 1.9407322768966106e-17im, -5.031197857376225e-17 - 3.333664490499395e-17im, 7.026984180248935e-17 - 6.8672674888536374e-18im, -1.680972932786818e-16 - 1.2848025670639224e-16im, -1.7829256277553386e-17 + 8.295613278180051e-17im, -2.1186464247426495e-16 + 8.23154781642051e-32im, 1.7829256277553617e-17 + 8.295613278179993e-17im, -1.6809729327868276e-16 + 1.2848025670639284e-16im, -7.026984180248932e-17 - 6.867267488853732e-18im, -5.031197857376244e-17 + 3.333664490499395e-17im, -4.32475704330042e-17 - 1.9407322768966127e-17im, 7.402087495423824e-19 - 1.6550320540084843e-17im, 3.0363378441997872e-18 - 9.255592622309867e-19im, 1.9059010572119847e-19 + 2.6491003142494887e-19im, -8.293808559254458e-21 + 1.1492524380320345e-20im, 2.4193876675606985e-23 - 7.764988303363472e-24im, -3.8581674879296267e-22 - 5.271647674530023e-22im, -4.164098138615032e-21 + 5.91705231812795e-21im, 4.2676354831000444e-20 + 1.2193107584112086e-20im, -1.255222126691705e-20 - 1.5842556579309561e-19im, -2.6498840560002225e-19 + 1.5020413698439236e-19im, 2.1223036224104672e-19 - 2.6204172514409774e-20im, -6.792601663938908e-19 + 3.526203638213381e-19im, 8.895193421847321e-19 + 5.785007703631095e-19im, -1.575490877575272e-19 + 3.3906270797891052e-19im, 1.311270511520244e-18 - 5.8559059999106615e-34im, 1.575490877575249e-19 + 3.3906270797891346e-19im, 8.895193421847389e-19 - 5.785007703631138e-19im, 6.792601663938897e-19 + 3.5262036382133905e-19im, 2.122303622410487e-19 + 2.6204172514410223e-20im, 2.649884056000228e-19 + 1.5020413698439248e-19im, -1.255222126691691e-20 + 1.5842556579309605e-19im, -4.267635483100035e-20 + 1.2193107584112091e-20im, -4.164098138615038e-21 - 5.917052318127953e-21im, 3.8581674879296093e-22 - 5.271647674530005e-22im, 2.4193876675607153e-23 + 7.764988303363543e-24im]

new_weights_1 = ComplexF64[0.0 + 0.0im, 0.01386750490563073 + 0.000741249316661101im, 0.005345224838248485 + 8.673617379884035e-19im, -0.013867504905630731 + 0.0007412493166611006im, 5.970695970695971e-5 - 0.00015487446326207155im, -0.0004249829415523648 - 8.452574418670157e-5im, -0.0002571428571428571 - 5.278249527359715e-20im, 0.00042498294155236496 - 8.452574418670158e-5im, 5.970695970695975e-5 + 0.00015487446326207158im, -8.659571057829309e-7 - 7.03881390944807e-7im, -2.5015358549330495e-6 + 5.335164835164836e-6im, 6.0175065929790496e-6 + 3.1092761514945114e-6im, 5.3261347495404564e-6 + 1.3975654187881809e-21im, -6.017506592979054e-6 + 3.1092761514945144e-6im, -2.501535854933051e-6 - 5.3351648351648375e-6im, 8.659571057829308e-7 - 7.038813909448072e-7im, -4.481000684297391e-9 + 2.8957443041021317e-9im, 3.1664107256551075e-8 + 2.8294354279145335e-8im, 5.3208791208791226e-8 - 8.622258835236214e-8im, -4.136171186968939e-8 - 6.062080715890003e-8im, -5.7857142857142853e-8 - 2.002176195084779e-23im, 4.13617118696895e-8 - 6.062080715890011e-8im, 5.3208791208791246e-8 + 8.622258835236219e-8im, -3.166410725655106e-8 + 2.8294354279145335e-8im, -4.481000684297397e-9 - 2.8957443041021333e-9im, 5.106803250852297e-12 + 1.926210194301726e-11im, 1.8199820798464835e-10 - 1.0878953159172951e-10im, -5.466412056879413e-10 - 5.596341430111792e-10im, -7.324825081032316e-10 + 7.958398744113026e-10im, -2.0058355309931644e-11 + 7.237108283651017e-10im, 2.4483038768048863e-10 + 1.8829974562815519e-25im, 2.0058355309929964e-11 + 7.237108283651031e-10im, -7.324825081032313e-10 - 7.95839874411303e-10im, 5.466412056879409e-10 - 5.596341430111789e-10im, 1.8199820798464855e-10 + 1.0878953159172958e-10im, -5.10680325085231e-12 + 1.926210194301729e-11im, 6.115232664271344e-14 + 3.391266105365198e-15im, -1.8700328645298088e-13 - 7.942178099735744e-13im, -3.6049026354896555e-12 + 1.929407671425029e-12im, 5.646513215933878e-12 + 7.084349921829486e-12im, 7.020995859097175e-12 - 3.686616045842402e-12im, 3.4207143210202587e-12 - 5.299928190968214e-12im, 2.249344023323624e-12 - 1.6343127024449657e-27im, -3.420714321020241e-12 - 5.29992819096823e-12im, 7.020995859097164e-12 + 3.686616045842398e-12im, -5.646513215933872e-12 + 7.0843499218294815e-12im, -3.6049026354896587e-12 - 1.9294076714250314e-12im, 1.8700328645298134e-13 - 7.942178099735752e-13im, 6.11523266427135e-14 - 3.39126610536523e-15im, 5.790004362879288e-17 - 1.4929810116526993e-16im, -2.5549376445420474e-15 - 2.0132322699004008e-16im, 3.1517985543898227e-15 + 1.5940681319040212e-14im, 4.5648524603943365e-14 - 2.0736532207980427e-14im, -3.538693128210213e-14 - 6.273737585510817e-14im, -4.662052383283869e-14 - 6.6978687766316345e-15im, -3.7024295560790104e-14 + 1.711585681978019e-14im, -4.766894983767256e-14 + 1.9402200125597726e-29im, 3.702429556078998e-14 + 1.711585681978037e-14im, -4.662052383283851e-14 + 6.697868776631746e-15im, 3.5386931282102066e-14 - 6.273737585510812e-14im, 4.564852460394339e-14 + 2.0736532207980456e-14im, -3.1517985543898294e-15 + 1.5940681319040228e-14im, -2.5549376445420513e-15 + 2.0132322699004207e-16im, -5.790004362879293e-17 - 1.4929810116526954e-16im, -2.824345396990952e-19 - 2.305116595476288e-19im, -2.5891998846679733e-18 + 6.30146031043336e-18im, 5.1974019425531305e-17 + 5.614591760062754e-18im, -3.062893731479314e-17 - 2.0513761135493157e-16im, -4.0731599598540157e-16 + 1.4104301182000668e-16im, 9.178686108023211e-17 + 3.952447323864519e-16im, 1.8487657386345477e-16 + 2.5392766156683015e-16im, 2.109362351884499e-16 + 1.0428905987933555e-16im, 4.1746874442196936e-16 - 2.627656480266976e-31im, -2.1093623518844937e-16 + 1.0428905987933376e-16im, 1.8487657386345288e-16 - 2.5392766156683143e-16im, -9.178686108023179e-17 + 3.952447323864518e-16im, -4.073159959854015e-16 - 1.41043011820007e-16im, 3.0628937314793213e-17 - 2.0513761135493167e-16im, 5.19740194255314e-17 - 5.6145917600628006e-18im, 2.5891998846679733e-18 + 6.301460310433347e-18im, -2.824345396990953e-19 + 2.305116595476286e-19im, -6.183671601067782e-22 + 3.978565640883631e-22im, 1.1998879946869022e-20 + 1.0145927630240722e-20im, 5.694942414275014e-20 - 1.2959975191221573e-19im, -6.801476129765447e-19 - 9.862054300355904e-20im, 1.6043747690909511e-19 + 1.8762651617754983e-18im, 2.6454247508849884e-18 - 5.059690473520647e-19im, 6.303432060197297e-19 - 1.6420011380021093e-18im, 3.1891388644539746e-20 - 2.1364516473218648e-18im, -5.094202473947501e-19 - 1.8781648620956648e-18im, -2.122572734643972e-18 + 3.0530061781381144e-33im, 5.094202473947494e-19 - 1.8781648620956482e-18im, 3.189138864455573e-20 + 2.136451647321877e-18im, -6.303432060197305e-19 - 1.6420011380021089e-18im, 2.6454247508849857e-18 + 5.059690473520682e-19im, -1.6043747690909588e-19 + 1.8762651617754995e-18im, -6.801476129765462e-19 + 9.862054300355963e-20im, -5.69494241427501e-20 - 1.2959975191221546e-19im, 1.1998879946869028e-20 - 1.0145927630240725e-20im, 6.183671601067764e-22 + 3.978565640883607e-22im, 3.386734336835211e-25 + 1.287806923617558e-24im, 2.7200084683328985e-23 - 1.6911710154774128e-23im, -2.4854853853189224e-22 - 2.191475344526718e-22im, -8.169076212915868e-22 + 1.719436434506917e-21im, 6.3709454663846956e-21 + 1.2287581700781825e-21im, 4.2555522479116906e-23 - 1.2729957877047004e-20im, -1.2188185624288119e-20 - 8.744419125775042e-22im, -9.077892770670554e-21 + 2.4548127039498536e-21im, -6.855640875294468e-21 + 1.0041085420963526e-20im, -2.410901144268669e-21 + 1.3923969036317433e-20im, 4.41631307028768e-21 - 2.901107516208298e-35im, 2.410901144268647e-21 + 1.3923969036317292e-20im, -6.85564087529457e-21 - 1.0041085420963612e-20im, 9.077892770670562e-21 + 2.4548127039498672e-21im, -1.2188185624288075e-20 + 8.744419125774748e-22im, -4.255552247911164e-23 - 1.2729957877047013e-20im, 6.37094546638471e-21 - 1.228758170078186e-21im, 8.169076212915861e-22 + 1.7194364345069143e-21im, -2.485485385318924e-22 + 2.191475344526722e-22im, -2.72000846833289e-23 - 1.691171015477406e-23im, 3.386734336835252e-25 - 1.2878069236175654e-24im]
new_weights_2 = ComplexF64[0.0 + 0.0im, 0.0 - 0.4818120558297157im, 0.26726124191242456 + 0.0im, 0.0 - 0.4818120558297158im, -0.004107142857142856 - 0.0013363062095621222im, 0.0007412493166611018 + 0.009311039008066346im, -0.014642857142857145 - 8.673617379884035e-19im, -0.0007412493166611016 + 0.009311039008066352im, -0.004107142857142856 + 0.0013363062095621226im, -1.518821965854794e-5 + 2.08696980226608e-5im, 0.00012014518649707795 + 3.443223443223443e-5im, -3.896108521105783e-5 - 4.028337060187992e-5im, 0.00033789457013213664 + 2.6718000709855095e-20im, 3.8961085211057755e-5 - 4.028337060188008e-5im, 0.000120145186497078 - 3.4432234432234474e-5im, 1.5188219658547952e-5 + 2.0869698022660797e-5im, 6.788821297749878e-8 + 9.367604426921294e-8im, 4.960329103938648e-7 - 7.153266855429368e-7im, -1.5606684981684973e-6 - 2.681178484570149e-7im, 9.172960293681146e-7 - 1.5155201789725085e-6im, -4.299107142857143e-6 - 2.6090696986113604e-22im, -9.172960293681129e-7 - 1.5155201789725053e-6im, -1.5606684981684977e-6 + 2.6811784845701543e-7im, -4.960329103938648e-7 - 7.153266855429366e-7im, 6.788821297749879e-8 - 9.367604426921305e-8im, 3.947268076095154e-10 - 1.275573805275341e-10im, -2.541963784059135e-9 - 3.386225496115609e-9im, -7.174057227776114e-9 + 1.1571076139156058e-8im, 7.876549622813824e-9 - 3.1271585557300006e-9im, -1.2777915234474057e-8 + 3.485923460522948e-8im, 2.8993072225321018e-8 + 1.400856249698234e-24im, 1.2777915234474032e-8 + 3.485923460522941e-8im, 7.876549622813817e-9 + 3.127158555730009e-9im, 7.17405722777611e-9 + 1.1571076139156048e-8im, -2.5419637840591366e-9 + 3.3862254961156132e-9im, -3.947268076095162e-10 - 1.275573805275343e-10im, 2.4764149813205593e-15 - 1.2395255829130878e-12im, -1.5136711438608775e-11 + 5.11504525810874e-12im, 4.5899960382152345e-11 + 5.7228762618092206e-11im, 4.864485004860311e-11 - 1.0769348731795654e-10im, 6.35960101760488e-11 + 1.0329560465172461e-10im, 1.1308779434417667e-10 - 3.813680085423408e-10im, -1.0733418367346122e-11 - 1.7971699251548126e-26im, -1.1308779434417657e-10 - 3.8136800854233997e-10im, 6.359601017604911e-11 - 1.0329560465172479e-10im, -4.864485004860302e-11 - 1.076934873179564e-10im, 4.5899960382152416e-11 - 5.7228762618092284e-11im, 1.5136711438608798e-11 + 5.1150452581087475e-12im, 2.476414981320906e-15 + 1.2395255829130892e-12im, -3.01694366022282e-15 - 9.882672259531884e-16im, 4.460780637491758e-16 + 4.9437831960431053e-14im, 2.767601703028533e-13 - 1.006177630267315e-13im, -5.14735232846022e-13 - 5.64303704817274e-13im, 7.06769085570884e-14 + 5.099397551418234e-13im, -1.5771184444952737e-12 - 1.3206648672027715e-12im, -5.845090506762989e-13 + 2.410322651857389e-12im, -1.9631324725238415e-12 + 3.7750824987537793e-28im, 5.845090506763007e-13 + 2.4103226518573837e-12im, -1.5771184444952802e-12 + 1.3206648672027743e-12im, -7.067690855708901e-14 + 5.099397551418217e-13im, -5.147352328460227e-13 + 5.643037048172744e-13im, -2.7676017030285355e-13 - 1.0061776302673159e-13im, 4.460780637491383e-16 - 4.943783196043114e-14im, 3.0169436602228096e-15 - 9.882672259531898e-16im, -4.197962217417128e-18 + 5.744143821118435e-18im, 1.2380787952750688e-16 + 3.9271159902813966e-17im, -2.522368738977876e-17 - 9.49740935957381e-16im, -3.1187039036531656e-15 + 1.2754968413363652e-15im, 3.824707198515355e-15 + 3.076296615934627e-15im, -5.178678222529332e-15 + 8.670296057079864e-16im, 1.525286676925485e-14 + 1.0354358896855252e-14im, 4.327632117085029e-16 - 6.033865096515739e-15im, 2.2888863329360703e-14 - 5.203894904716057e-30im, -4.3276321170851235e-16 - 6.0338650965157075e-15im, 1.52528667692549e-14 - 1.0354358896855292e-14im, 5.178678222529328e-15 + 8.670296057079951e-16im, 3.824707198515368e-15 - 3.0762966159346303e-15im, 3.1187039036531684e-15 + 1.275496841336366e-15im, -2.52236873897778e-17 + 9.49740935957383e-16im, -1.2380787952750656e-16 + 3.927115990281399e-17im, -4.1979622174171225e-18 - 5.7441438211184344e-18im, 8.293808559254514e-21 + 1.1492524380320382e-20im, 1.7313750978764657e-19 - 2.4102934458163805e-19im, -2.4629565319455575e-18 - 7.430771489068473e-19im, 6.269275107101062e-19 + 1.1511749152096885e-17im, 2.307135766950769e-17 - 1.1533811463435688e-17im, -1.7654955194153783e-17 - 9.774865748738647e-19im, 6.016649953665422e-17 - 3.628747524959902e-17im, -8.785903883407517e-17 - 5.060942441565115e-17im, 2.2007405710371807e-17 - 4.638139782343547e-17im, -1.4573952103531645e-16 + 4.7596038785915785e-32im, -2.200740571037162e-17 - 4.6381397823435654e-17im, -8.785903883407576e-17 + 5.060942441565151e-17im, -6.016649953665418e-17 - 3.6287475249599034e-17im, -1.7654955194153906e-17 + 9.774865748738338e-19im, -2.307135766950772e-17 - 1.1533811463435703e-17im, 6.269275107100943e-19 - 1.1511749152096915e-17im, 2.4629565319455513e-18 - 7.430771489068474e-19im, 1.731375097876466e-19 + 2.410293445816381e-19im, -8.293808559254458e-21 + 1.1492524380320345e-20im, 2.4193876675606985e-23 - 7.764988303363472e-24im, -3.547841587327391e-22 - 4.84163678712697e-22im, -3.450975261697284e-21 + 4.925849742216273e-21im, 3.131541890750901e-20 + 8.729981933688475e-21im, -9.78261373143703e-21 - 9.649993669081082e-20im, -1.0317081422934597e-19 + 7.758858438838422e-20im, 2.3980175967316917e-20 - 1.5093847617344028e-19im, -4.1633449374617023e-19 + 3.2692540169471634e-19im, 2.6055686309184674e-19 + 9.777166880302465e-20im, -2.242600562091205e-19 + 6.494561349801343e-19im, 5.185456070101903e-19 - 2.7759428307213905e-34im, 2.2426005620911906e-19 + 6.494561349801351e-19im, 2.605568630918499e-19 - 9.777166880302677e-20im, 4.1633449374616926e-19 + 3.2692540169471696e-19im, 2.398017596731817e-20 + 1.5093847617344073e-19im, 1.0317081422934631e-19 + 7.758858438838427e-20im, -9.782613731436953e-21 + 9.64999366908111e-20im, -3.1315418907508946e-20 + 8.72998193368848e-21im, -3.45097526169729e-21 - 4.925849742216276e-21im, 3.5478415873273755e-22 - 4.841636787126953e-22im, 2.4193876675607153e-23 + 7.764988303363543e-24im]

expansion_order = 10
multipole_expansion = initialize_expansion(expansion_order)
i, i_compressed = 1, 1
for n in 0:expansion_order
    for m in -n:n
        if m >= 0
            multipole_expansion[1,1,i_compressed] = real(weights_1[i])
            multipole_expansion[2,1,i_compressed] = imag(weights_1[i])
            multipole_expansion[1,2,i_compressed] = real(weights_2[i])
            multipole_expansion[2,2,i_compressed] = imag(weights_2[i])
            i_compressed += 1
        end
        i += 1
    end
end

r = 0.03741657386773942

FastMultipole.transform_lamb_helmholtz_multipole!(multipole_expansion, r, expansion_order)

i, i_compressed = 1, 1
for n in 0:expansion_order
    for m in -n:n
        if m >= 0
            @test isapprox(multipole_expansion[1,1,i_compressed], real(new_weights_1[i]); atol=1e-12)
            @test isapprox(multipole_expansion[2,1,i_compressed], imag(new_weights_1[i]); atol=1e-12)
            @test isapprox(multipole_expansion[1,2,i_compressed], real(new_weights_2[i]); atol=1e-12)
            @test isapprox(multipole_expansion[2,2,i_compressed], imag(new_weights_2[i]); atol=1e-12)
            i_compressed += 1
        end
        i += 1
    end
end

end

@testset "Lamb-Helmholtz transform: local" begin

weights_1 = ComplexF64[0.010780991620515792 + 4.345144324966484e-19im, 0.006290150918188222 - 0.0005860148861855067im, 0.02243665520413517 + 8.678469042494587e-19im, -0.006290150918188224 - 0.000586014886185503im, 0.00047057134785887325 - 0.0008661089997913827im, 0.02019187821220814 - 0.0025639346949135723im, 0.07001570355516952 + 2.595459521669631e-18im, -0.020191878212208147 - 0.0025639346949135598im, 0.00047057134785887444 + 0.0008661089997913827im, -0.00010191591417968455 - 0.0001916823071403431im, 0.002405047765842642 - 0.004636621957785709im, 0.08634670318058331 - 0.013730339091799005im, 0.2912179279004004 + 1.0329714993432085e-17im, -0.08634670318058334 - 0.013730339091798953im, 0.0024050477658426475 + 0.004636621957785709im, 0.00010191591417968507 - 0.00019168230714034293im, -6.319050255488774e-5 - 6.011011438773417e-6im, -0.0007715609370281495 - 0.001404336283016777im, 0.014743369470808962 - 0.029759493941162472im, 0.4611632524838764 - 0.08734550354232215im, 1.5135514146226277 + 5.128005936664247e-17im, -0.46116325248387663 - 0.08734550354232189im, 0.014743369470809 + 0.02975949394116247im, 0.0007715609370281533 - 0.0014043362830167758im, -6.319050255488778e-5 + 6.011011438773557e-6im, -1.4617287876663856e-5 + 1.8141823127117872e-5im, -0.0005985417209805243 - 5.0462515261306365e-5im, -0.00666555187491898 - 0.011756881569709452im, 0.10539142497145067 - 0.22265195678128183im, 2.9531727739333546 - 0.6445691402738293im, 9.436342282112749 + 3.0476443079257406e-16im, -2.953172773933356 - 0.6445691402738277im, 0.10539142497145094 + 0.2226519567812818im, 0.006665551874919012 - 0.011756881569709441im, -0.0005985417209805247 + 5.046251526130768e-5im, 1.4617287876663841e-5 + 1.8141823127117866e-5im, 3.1393861689889844e-6 + 9.82845792405903e-6im, -0.00016689570722338084 + 0.0002109245750623405im, -0.006297989438953788 - 0.00046431897832906264im, -0.06469081495226851 - 0.11071484017147304im, 0.8605761316924685 - 1.902240141702108im, 22.045851794677883 - 5.416754544311025im, 68.61244572397777 + 2.107574064529815e-15im, -22.04585179467789 - 5.416754544311013im, 0.860576131692471 + 1.9022401417021078im, 0.06469081495226882 - 0.11071484017147293im, -0.006297989438953792 + 0.00046431897832907636im, 0.00016689570722338068 + 0.0002109245750623404im, 3.1393861689889683e-6 - 9.828457924059047e-6im, 5.157699486720724e-6 + 1.4519588589277074e-6im, 4.3783854476546476e-5 + 0.00013360020792176587im, -0.0020786042110076263 + 0.00267439813291028im, -0.07288036580101302 - 0.0046181134561111455im, -0.6966791306096399 - 1.1582900277914887im, 7.901398092308022 - 18.269093998652945im, 187.94297951875396 - 51.087165490984574im, 569.9537975933071 + 1.6607748022419004e-14im, -187.94297951875404 - 51.08716549098447im, 7.901398092308044 + 18.26909399865294im, 0.696679130609643 - 1.1582900277914874im, -0.07288036580101308 + 0.0046181134561113025im, 0.002078604211007624 + 0.0026743981329102793im, 4.378385447654626e-5 - 0.0001336002079217661im, -5.157699486720726e-6 + 1.4519588589277055e-6im, 2.41412543394414e-6 - 2.084514057794506e-6im, 8.116139944968671e-5 + 2.2278462325418054e-5im, 0.0006569796346068445 + 0.0019555645032141846im, -0.028042730352556246 + 0.036724338370355915im, -0.9198503084030829 - 0.04895851745258431im, -8.242826503950225 - 13.327906144414145im, 80.56537410195558 - 194.80489213248165im, 1801.1855017159025 - 534.4265109278451im, 5324.442376234814 + 1.4673871956039694e-13im, -1801.1855017159035 - 534.4265109278443im, 80.56537410195581 + 194.80489213248165im, 8.24282650395026 - 13.327906144414131im, -0.9198503084030835 + 0.048958517452586295im, 0.028042730352556215 + 0.0367243383703559im, 0.0006569796346068415 - 0.0019555645032141877im, -8.116139944968674e-5 + 2.2278462325418017e-5im, 2.4141254339441344e-6 + 2.084514057794514e-6im, -3.3316821158814255e-7 - 2.1508417450544883e-6im, 4.2720320229888624e-5 - 3.7312439560729596e-5im, 0.00136211607292745 + 0.00036449459476693344im, 0.010552587740855272 + 0.03066613818877909im, -0.4073927182045868 + 0.542920536628664im, -12.574661208529195 - 0.5444162975611403im, -106.26729030622387 - 167.27678920006738im, 903.1332903710584 - 2283.292265703755im, 19166.35088456581 - 6141.696532775044im, 55247.275523520635 + 1.435139911070999e-12im, -19166.35088456582 - 6141.696532775035im, 903.1332903710608 + 2283.2922657037548im, 106.26729030622434 - 167.2767892000672im, -12.574661208529204 + 0.5444162975611678im, 0.4073927182045864 + 0.5429205366286639im, 0.010552587740855223 - 0.03066613818877914im, -0.0013621160729274503 + 0.00036449459476693295im, 4.272032022988853e-5 + 3.7312439560729745e-5im, 3.331682115881281e-7 - 2.1508417450544747e-6im, -1.5616316309351838e-6 - 9.865392541503717e-7im, -6.961357155161272e-6 - 4.274225801048614e-5im, 0.0008003790262947945 - 0.0007069919675803664im, 0.024285681371878864 + 0.006333871261248146im, 0.18064287891627157 + 0.5129010627778663im, -6.340584260904835 + 8.597142047767859im, -185.0851054284921 - 6.2133442350096315im, -1482.534647526988 - 2274.1142505572248im, 11038.33647830418 - 29174.900799599458im, 224188.9288647998 - 76918.5350663742im, 630354.0563838675 + 1.537299950984917e-11im, -224188.92886479988 - 76918.5350663741im, 11038.336478304213 + 29174.900799599454im, 1482.5346475269944 - 2274.114250557222im, -185.08510542849223 + 6.213344235010034im, 6.340584260904828 + 8.597142047767855im, 0.18064287891627076 - 0.5129010627778672im, -0.02428568137187887 + 0.006333871261248135im, 0.0008003790262947927 + 0.0007069919675803693im, 6.96135715516098e-6 - 4.274225801048588e-5im, -1.5616316309352046e-6 + 9.86539254150382e-7im]
weights_2 = ComplexF64[-0.005640758825220321 - 9.65313711854889e-19im, -0.000368225150821776 - 1.1465718353854426im, -0.029679475347150864 - 3.000427160029108e-18im, 0.00036822515082176954 - 1.146571835385443im, -0.11245412919066954 - 0.0742365093367728im, -0.0023104737618691736 - 3.598303382256829im, -0.14906153959603502 - 1.2433296888600175e-17im, 0.0023104737618691432 - 3.5983033822568298im, -0.11245412919066952 + 0.07423650933677282im, -0.024251076985085513 + 0.010352669700217018im, -0.587202810464654 - 0.38743064209437095im, -0.01608874852956425 - 15.052826564505535im, -0.8568171836218941 - 6.439429124937247e-17im, 0.01608874852956407 - 15.052826564505539im, -0.5872028104646538 + 0.38743064209437106im, 0.024251076985085517 + 0.01035266970021702im, -0.0012956080901357703 + 0.007103997074622969im, -0.1770743614019942 + 0.0756349121397182im, -3.6788764919152284 - 2.4256850592464443im, -0.12596552926501484 - 78.69268017903111im, -5.695419091384166 - 4.0016114515413264e-16im, 0.12596552926501356 - 78.69268017903113im, -3.678876491915228 + 2.425685059246445im, 0.17707436140199423 + 0.07563491213971822im, -0.0012956080901357697 - 0.007103997074622978im, 0.0018350943535384962 + 0.001759175456149431im, -0.012145771069083815 + 0.06666187952084177im, -1.4774133771649836 + 0.6314695029983022im, -26.8857722213642 - 17.713517656369184im, -1.1042006488181002 - 493.5359339367807im, -43.32962019525478 - 2.900756674589215e-15im, 1.1042006488180898 - 493.5359339367808im, -26.885772221364192 + 17.71351765636919im, 1.4774133771649838 + 0.6314695029983024im, -0.012145771069083808 - 0.06666187952084186im, -0.0018350943535385014 + 0.0017591754561494318im, 0.0010666655971576355 - 0.00024146584858567423im, 0.021041020512019806 + 0.02016454299370204im, -0.12648222852386862 + 0.6949579919491674im, -13.865349159899841 + 5.930663019296036im, -224.52025162133594 - 147.79191777153687im, -10.752031373131716 - 3610.2546842802794im, -372.5110494276021 - 2.4028011557248053e-14im, 10.752031373131622 - 3610.2546842802803im, -224.52025162133592 + 147.79191777153693im, 13.865349159899845 + 5.930663019296038im, -0.1264822285238686 - 0.6949579919491684im, -0.021041020512019875 + 0.020164542993702045im, 0.0010666655971576348 + 0.0002414658485856755im, 0.00019654962893754933 - 0.0005201546914946472im, 0.014447577758728297 - 0.0032725422825212827im, 0.26316313695090204 + 0.25211814909830044im, -1.4485118146777605 + 7.968582279028412im, -144.55967865621693 + 61.884226476459276im, -2108.9928830965423 - 1386.8609695109665im, -115.35582158856766 - 30174.325891927212im, -3576.895841212497 - 2.238775551376049e-13im, 115.35582158856668 - 30174.325891927223im, -2108.992883096542 + 1386.860969510967im, 144.55967865621693 + 61.8842264764593im, -1.4485118146777605 - 7.968582279028425im, -0.2631631369509029 + 0.25211814909830055im, 0.014447577758728288 + 0.0032725422825213004im, -0.0001965496289375499 - 0.0005201546914946457im, -0.00019078604465383293 - 0.00026396293162260856im, 0.00307033738437764 - 0.00812826066590916im, 0.210720238007156 - 0.04776195907035124im, 3.5653876881391486 + 3.4145221062504536im, -18.09249560282653 + 99.6646271185394im, -1657.6257265976794 + 710.2607601172078im, -22008.304117876643 - 14456.288411556689im, -1353.4012126887599 - 283647.8177267437im, -37974.01764470203 - 2.3173368327725587e-12im, 1353.401212688749 - 283647.81772674376im, -22008.30411787664 + 14456.288411556692im, 1657.6257265976799 + 710.2607601172081im, -18.092495602826528 - 99.66462711853956im, -3.5653876881391597 + 3.414522106250455im, 0.21072023800715586 + 0.047761959070351495im, -0.003070337384377649 - 0.008128260665909133im, -0.00019078604465383296 + 0.00026396293162260883im, -0.00021529577272383287 + 8.722262604921744e-6im, -0.0033779232017945716 - 0.004672071941924603im, 0.0511547113543518 - 0.1354751933579642im, 3.292611721845972 - 0.7468353021305149im, 52.01571162067872 + 49.795312150899605im, -244.7553727984164 + 1350.2436559556052im, -20732.169937960025 + 8892.27280441656im, -252595.39055490846 - 165713.45874451444im, -17247.97132107708 - 2.9618924732562676e6im, -441897.5904052401 - 2.6380485597523905e-11im, 17247.97132107694 - 2.961892473256268e6im, -252595.39055490846 + 165713.4587445145im, 20732.16993796003 + 8892.272804416561im, -244.7553727984164 - 1350.243655955607im, -52.015711620678886 + 49.79531215089961im, 3.292611721845969 + 0.7468353021305189im, -0.05115471135435196 - 0.13547519335796376im, -0.003377923201794573 + 0.0046720719419246085im, 0.00021529577272383073 + 8.722262604920613e-6im, -0.00010278839931586166 + 0.00017034559591720742im, -0.004256564962027744 + 0.0001723054499661447im, -0.06331974875075061 - 0.08754890728056092im, 0.905464375551935 - 2.398940407472978im, 54.873596909335674 - 12.456007698830554im, 812.9933529798714 + 777.9618120780841im, -3564.8867651420815 + 19697.76835600485im, -280863.769489323 + 120597.54550721019im, -3.162189043837943e6 - 2.071724370732128e6im, -237358.26947541203 - 3.4012860091402754e7im, -5.594977611354108e6 - 3.2755208898271563e-10im, 237358.26947541026 - 3.401286009140276e7im, -3.1621890438379426e6 + 2.0717243707321286e6im, 280863.7694893231 + 120597.54550721026im, -3564.8867651420824 - 19697.76835600488im, -812.993352979874 + 777.9618120780844im, 54.873596909335646 + 12.456007698830623im, -0.9054643755519376 - 2.398940407472971im, -0.06331974875075065 + 0.08754890728056103im, 0.004256564962027701 + 0.00017230544996612202im, -0.00010278839931586203 - 0.00017034559591720889im]
new_weights_1 = ComplexF64[0.010780991620515792 + 4.345144324966484e-19im, -1.083073777784344 - 0.00023616223450978837im, 0.02243665520413517 + 8.678469042494587e-19im, 1.0830737777843444 - 0.0002361622345097907im, -0.07006192645859806 + 0.10597715035236943im, -1.6891916022572777 - 0.0014663380608798222im, 0.07001570355516952 + 2.595459521669631e-18im, 1.6891916022572782 - 0.001466338060879824im, -0.07006192645859809 - 0.10597715035236942im, 0.009734209995364234 + 0.022849393432226046im, -0.24299487883639376 + 0.3672996962685693im, -4.680909849007759 - 0.008635004237883137im, 0.2912179279004004 + 1.0329714993432085e-17im, 4.68090984900776 - 0.008635004237883142im, -0.24299487883639379 - 0.36729969626856923im, -0.009734209995364236 + 0.02284939343222605im, 0.006686354466078509 + 0.0012249530464343396im, 0.053124284809018756 + 0.12477512499634683im, -1.1375846942337335 + 1.71790045407113im, -18.23041903532435 - 0.05742537564316169im, 1.5135514146226277 + 5.128005936664247e-17im, 18.23041903532435 - 0.05742537564316173im, -1.137584694233734 - 1.7179004540711298im, -0.05312428480901877 + 0.12477512499634685im, 0.006686354466078518 - 0.0012249530464343388im, 0.0016567845615711588 - 0.0017253909698605088im, 0.050070100035848775 + 0.00918134624235799im, 0.3533119449092131 + 0.8304620485639149im, -6.626491075455439 + 9.99507345714216im, -90.82904432867085 - 0.43474777195668407im, 9.436342282112749 + 3.0476443079257406e-16im, 90.82904432867088 - 0.43474777195668446im, -6.626491075455442 - 9.995073457142158im, -0.3533119449092132 + 0.830462048563915im, 0.05007010003584885 - 0.009181346242357984im, -0.0016567845615711597 - 0.0017253909698605136im, -0.00022627858603713397 - 0.001003616133745027im, 0.015798469551033565 - 0.016448395598263308im, 0.4338908384091601 + 0.07964996787429471im, 2.752686242081091 + 6.476055725574721im, -45.94538322335599 + 69.20371700555266im, -549.6411408425475 - 3.7141609552185257im, 68.61244572397777 + 2.107574064529815e-15im, 549.6411408425477 - 3.714160955218529im, -45.945383223356004 - 69.20371700555266im, -2.7526862420810914 + 6.476055725574723im, 0.4338908384091607 - 0.07964996787429468im, -0.015798469551033565 - 0.016448395598263364im, -0.00022627858603713522 + 0.0010036161337450263im, -0.0004890440075255365 - 0.00018529087692026707im, -0.0026212958261928885 - 0.011632159435682786im, 0.1690205235931309 - 0.17592037326113344im, 4.253400729482395 + 0.7818039953583485im, 24.501833264055573 + 57.70467169595534im, -368.57400142589023 + 554.235256257005im, -3907.597829940079 - 35.42999798319186im, 569.9537975933071 + 1.6607748022419004e-14im, 3907.597829940081 - 35.42999798319189im, -368.57400142589034 - 554.2352562570048im, -24.50183326405558 + 57.70467169595534im, 4.253400729482402 - 0.7818039953583484im, -0.169020523593131 - 0.17592037326113402im, -0.0026212958261929028 + 0.01163215943568278im, 0.0004890440075255351 - 0.00018529087692026764im, -0.0002483784436400874 + 0.00017918230999239529im, -0.006676203893202782 - 0.0025302222670057317im, -0.033377186675118804 - 0.14819923996359888im, 1.9995543974018744 - 2.0804591534478964im, 46.42609278901598 + 8.545929077751046im, 244.8156043436544 + 577.2666879258072im, -3353.183531211123 + 5032.746469677862im, -31885.724854715263 - 373.6923099968402im, 5324.442376234814 + 1.4673871956039694e-13im, 31885.72485471527 - 373.69230999684066im, -3353.1835312111234 - 5032.746469677861im, -244.81560434365446 + 577.2666879258074im, 46.42609278901606 - 8.545929077751042im, -1.9995543974018755 - 2.080459153447903im, -0.033377186675118985 + 0.14819923996359877im, 0.00667620389320276 - 0.002530222267005739im, -0.0002483784436400877 - 0.0001791823099923953im, 7.953899345132842e-6 + 0.00020240280380009215im, -0.0039030220038870317 + 0.0028154720874358527im, -0.09875008994122293 - 0.037437341112302784im, -0.4624955102001057 - 2.0548856666523285im, 25.87637831779438 - 26.912857838038498im, 557.5913815450538 + 102.80819101566244im, 2709.931090047171 + 6398.637762082661im, -34084.69523473311 + 51048.30963268103im, -293512.4947240363 - 4320.875618288714im, 55247.275523520635 + 1.435139911070999e-12im, 293512.4947240363 - 4320.875618288719im, -34084.695234733124 - 51048.30963268103im, -2709.931090047171 + 6398.6377620826615im, 557.5913815450546 - 102.80819101566242im, -25.876378317794384 - 26.912857838038583im, -0.46249551020010826 + 2.054885666652327im, 0.0987500899412226 - 0.0374373411123029im, -0.003903022003887037 - 0.0028154720874358535im, -7.953899345131781e-6 + 0.00020240280380009015im, 0.00016028461461246803 + 9.66732593280549e-5im, 0.00014037612533584126 + 0.0035970240157075133im, -0.06574416263808627 + 0.047421348976979145im, -1.5711864438357397 - 0.5958666532125585im, -6.920068161060834 - 30.76851468441658im, 363.2322195665259 - 377.6174873711861im, 7300.896203629678 + 1348.59371869946im, 32891.57395460506 + 77780.92894477016im, -382632.9067946206 + 571707.5862427194im, -3.007390790091421e6 - 54367.001096516484im, 630354.0563838675 + 1.537299950984917e-11im, 3.007390790091422e6 - 54367.00109651655im, -382632.9067946207 - 571707.5862427194im, -32891.573954605075 + 77780.92894477017im, 7300.896203629689 - 1348.59371869946im, -363.23221956652606 - 377.61748737118734im, -6.920068161060874 + 30.768514684416566im, 1.571186443835735 - 0.5958666532125603im, -0.06574416263808636 - 0.04742134897697918im, -0.00014037612533582215 + 0.003597024015707477im, 0.00016028461461246938 - 9.667325932805522e-5im]
new_weights_2 = ComplexF64[0.022557866736808475 + 1.885407907114847e-18im, 0.0007293714832119742 + 0.5628116450840432im, 0.041132600870558075 + 2.906043209852796e-18im, -0.0007293714832119662 + 0.5628116450840432im, 0.07351402992250795 + 0.0484634539643454im, 0.002784861092046695 + 1.168953169931513im, 0.12229396397966247 + 7.960487997353522e-18im, -0.002784861092046668 + 1.168953169931513im, 0.07351402992250794 - 0.0484634539643454im, 0.017808743441369023 - 0.007612612215131948im, 0.2866271635414923 + 0.18873338975790033im, 0.013831379369596206 + 3.6387557233026886im, 0.49599472172896797 + 3.0654510697839747e-17im, -0.01383137936959608 + 3.6387557233026886im, 0.2866271635414923 - 0.18873338975790044im, -0.017808743441369027 - 0.007612612215131953im, 0.0010123440992690538 - 0.005563163364584356im, 0.10366528197588057 - 0.04435758678832581im, 1.429986215046493 + 0.9402561909670006im, 0.08385583905213037 + 15.089536923573093im, 2.538120897712731 + 1.5104368819646341e-16im, -0.08385583905212968 + 15.089536923573107im, 1.4299862150464926 - 0.9402561909670011im, -0.1036652819758806 - 0.04435758678832584im, 0.0010123440992690531 + 0.0055631633645843665im, -0.0014967696811266334 - 0.0014338975955019582im, 0.007882800644072128 - 0.0433853274411867im, 0.7181768114170808 - 0.30765618267948425im, 8.667206352263186 + 5.689462021155045im, 0.5983929402743988 + 78.15105870044476im, 15.657830883659095 + 9.0410000935248e-16im, -0.5983929402743944 + 78.15105870044476im, 8.667206352263193 - 5.689462021155045im, -0.718176811417081 - 0.30765618267948436im, 0.007882800644072131 + 0.043385327441186755im, 0.001496769681126639 - 0.0014338975955019578im, -0.0008942943434431232 + 0.00020271409819256486im, -0.014677933766788945 - 0.014055282567125665im, 0.07012329867974632 - 0.3866122818716845im, 5.755638081349103 - 2.4688411122590352im, 61.73192350649299 + 40.44578198756224im, 4.905136134660998 + 485.28612517855345im, 112.97859966472839 + 6.358737318995664e-15im, -4.9051361346609585 + 485.28612517855436im, 61.73192350649296 - 40.44578198756227im, -5.755638081349099 - 2.4688411122590352im, 0.07012329867974634 + 0.3866122818716853im, 0.014677933766788987 - 0.014055282567125675im, -0.0008942943434431226 - 0.00020271409819256603im, -0.0001680933323954721 + 0.00044518320745570554im, -0.010578222985740545 + 0.0023998187690996583im, -0.1602735614127484 - 0.15340127645258572im, 0.7002100841231471 - 3.8679034953263542im, 52.30518603385684 - 22.4685838060756im, 504.7827978086293 + 330.01348314557276im, 45.378379342437285 + 3512.584464503954im, 933.0183845439483 + 5.133668333917173e-14im, -45.37837934243696 + 3512.5844645039506im, 504.7827978086293 - 330.01348314557276im, -52.3051860338569 - 22.468583806075607im, 0.7002100841231467 + 3.8679034953263614im, 0.1602735614127489 - 0.15340127645258578im, -0.010578222985740536 - 0.002399818769099671im, 0.00016809333239547255 + 0.0004451832074557039im, 0.00016581202122073986 + 0.00022925485889200648im, -0.002329924859489463 + 0.006173483050398039im, -0.13687172946636195 + 0.031079390586475582im, -1.925767986794284 - 1.8422321009493405im, 7.745656225479365 - 42.87688356985633im, 531.0124571632298 - 228.47203333392372im, 4657.496831315748 + 3037.625850995395im, 467.41970179757095 + 29031.027881858405im, 8675.896115748823 + 4.675785068986684e-13im, -467.4197017975673 + 29031.027881858405im, 4657.4968313157515 - 3037.6258509953987im, -531.0124571632298 - 228.4720333339236im, 7.745656225479369 + 42.876883569856375im, 1.9257679867942898 - 1.8422321009493392im, -0.1368717294663618 - 0.03107939058647574im, 0.0023299248594894706 + 0.006173483050398018im, 0.00016581202122073995 - 0.00022925485889200686im, 0.00018912270213372257 - 7.648568782967426e-6im, 0.0026381194162753674 + 0.0036459957661230296im, -0.03487393499904916 + 0.09244939595740986im, -1.9209575693531025 + 0.43661653786566934im, -25.227214263112067 - 24.11924861458654im, 93.94639293520098 - 521.2516713089374im, 5952.844460482433 - 2565.763396294122im, 47845.852966251 + 31122.162891947955im, 5303.562648780637 + 269687.2456999533im, 89684.17391208047 + 4.740410581561058e-12im, -5303.562648780608 + 269687.24569995375im, 47845.852966251 - 31122.162891947955im, -5952.844460482436 - 2565.7633962941272im, 93.94639293520109 + 521.2516713089383im, 25.227214263112145 - 24.11924861458656im, -1.9209575693531025 - 0.4366165378656718im, 0.034873934999049234 + 0.09244939595740961im, 0.0026381194162753705 - 0.0036459957661230348im, -0.00018912270213372064 - 7.648568782966403e-6im, -0.00010278839931586166 + 0.00017034559591720742im, -0.004256564962027744 + 0.0001723054499661447im, -0.06331974875075061 - 0.08754890728056092im, 0.905464375551935 - 2.398940407472978im, 54.873596909335674 - 12.456007698830554im, 812.9933529798714 + 777.9618120780841im, -3564.8867651420815 + 19697.76835600485im, -280863.769489323 + 120597.54550721019im, -3.162189043837943e6 - 2.071724370732128e6im, -237358.26947541203 - 3.4012860091402754e7im, -5.594977611354108e6 - 3.2755208898271563e-10im, 237358.26947541026 - 3.401286009140276e7im, -3.1621890438379426e6 + 2.0717243707321286e6im, 280863.7694893231 + 120597.54550721026im, -3564.8867651420824 - 19697.76835600488im, -812.993352979874 + 777.9618120780844im, 54.873596909335646 + 12.456007698830623im, -0.9054643755519376 - 2.398940407472971im, -0.06331974875075065 + 0.08754890728056103im, 0.004256564962027701 + 0.00017230544996612202im, -0.00010278839931586203 - 0.00017034559591720889im]

expansion_order = 10
local_expansion = initialize_expansion(expansion_order)
i, i_compressed = 1, 1
for n in 0:expansion_order
    for m in -n:n
        if m >= 0
            local_expansion[1,1,i_compressed] = real(weights_1[i])
            local_expansion[2,1,i_compressed] = imag(weights_1[i])
            local_expansion[1,2,i_compressed] = real(weights_2[i])
            local_expansion[2,2,i_compressed] = imag(weights_2[i])
            i_compressed += 1
        end
        i += 1
    end
end
r = 0.9501052573267869

FastMultipole.transform_lamb_helmholtz_local!(local_expansion, r, expansion_order)

i, i_compressed = 1, 1
for n in 0:expansion_order
    for m in -n:n
        if m >= 0
            @test isapprox(local_expansion[1,1,i_compressed], real(new_weights_1[i]); atol=1e-12)
            @test isapprox(local_expansion[2,1,i_compressed], imag(new_weights_1[i]); atol=1e-12)
            @test isapprox(local_expansion[1,2,i_compressed], real(new_weights_2[i]); atol=1e-12)
            @test isapprox(local_expansion[2,2,i_compressed], imag(new_weights_2[i]); atol=1e-12)
            i_compressed += 1
        end
        i += 1
    end
end

end

@testset "Lamb-Helmholtz transform: multipole-to-multipole" begin

weights_1 = ComplexF64[0.0 + 0.0im, -0.0025 - 0.005im, 0.0 + 0.0im, 0.0025 - 0.005im, 3.333333333333335e-5 + 2.500000000000001e-5im, -4.9999999999999996e-5 - 9.999999999999999e-5im, 0.0 + 0.0im, 4.9999999999999996e-5 - 9.999999999999999e-5im, 3.333333333333335e-5 - 2.500000000000001e-5im, -1.7187500000000013e-7 - 3.125000000000006e-8im, 7.500000000000004e-7 + 5.625000000000003e-7im, -4.843749999999998e-7 - 9.687499999999996e-7im, 0.0 + 0.0im, 4.843749999999998e-7 - 9.687499999999996e-7im, 7.500000000000004e-7 - 5.625000000000003e-7im, 1.7187500000000013e-7 - 3.125000000000006e-8im, 5.000000000000007e-10 - 1.458333333333335e-10im, -4.125000000000003e-9 - 7.500000000000011e-10im, 8.16666666666667e-9 + 6.125000000000003e-9im, -2.6249999999999974e-9 - 5.2499999999999966e-9im, 0.0 + 0.0im, 2.6249999999999974e-9 - 5.2499999999999966e-9im, 8.16666666666667e-9 - 6.125000000000003e-9im, 4.125000000000003e-9 - 7.500000000000011e-10im, 5.000000000000007e-10 + 1.458333333333335e-10im, -8.897569444444466e-13 + 8.246527777777796e-13im, 1.2500000000000005e-11 - 3.6458333333333345e-12im, -4.798177083333337e-11 - 8.72395833333334e-12im, 5.4166666666666686e-11 + 4.062500000000001e-11im, -5.772569444444427e-12 - 1.1545138888888862e-11im, 0.0 + 0.0im, 5.772569444444427e-12 - 1.1545138888888862e-11im, 5.4166666666666686e-11 - 4.062500000000001e-11im, 4.798177083333337e-11 - 8.72395833333334e-12im, 1.2500000000000005e-11 + 3.6458333333333345e-12im, 8.897569444444466e-13 + 8.246527777777796e-13im, 8.184523809523819e-16 - 2.1763392857142933e-15im, -2.2879464285714336e-14 + 2.1205357142857183e-14im, 1.5178571428571467e-13 - 4.427083333333343e-14im, -3.4988839285714296e-13 - 6.36160714285715e-14im, 2.235863095238098e-13 + 1.676897321428574e-13im, 2.834821428571441e-14 + 5.669642857142871e-14im, 0.0 + 0.0im, -2.834821428571441e-14 + 5.669642857142871e-14im, 2.235863095238098e-13 - 1.676897321428574e-13im, 3.4988839285714296e-13 - 6.36160714285715e-14im, 1.5178571428571467e-13 + 4.427083333333343e-14im, 2.2879464285714336e-14 + 2.1205357142857183e-14im, 8.184523809523819e-16 + 2.1763392857142933e-15im, 3.933376736111114e-19 + 3.7706163194444516e-18im, 2.1484375000000026e-17 - 5.71289062500002e-17im, -2.8639051649305604e-16 + 2.6543511284722267e-16im, 1.1718750000000027e-15 - 3.417968750000007e-16im, -1.7254638671875033e-15 - 3.1372070312500076e-16im, 4.316406250000017e-16 + 3.2373046875000143e-16im, 3.2781304253472126e-16 + 6.556260850694421e-16im, 0.0 + 0.0im, -3.2781304253472126e-16 + 6.556260850694421e-16im, 4.316406250000017e-16 - 3.2373046875000143e-16im, 1.7254638671875033e-15 - 3.1372070312500076e-16im, 1.1718750000000027e-15 + 3.417968750000007e-16im, 2.8639051649305604e-16 + 2.6543511284722267e-16im, 2.1484375000000026e-17 + 5.71289062500002e-17im, -3.933376736111114e-19 + 3.7706163194444516e-18im, -2.8935185185185183e-21 - 4.538346009700186e-21im, 1.0489004629629646e-20 + 1.0054976851851883e-19im, 2.750909391534395e-19 - 7.3149181547619315e-19im, -2.298538773148151e-18 + 2.130353009259262e-18im, 6.322337962962972e-18 - 1.844015239197533e-18im, -5.621744791666671e-18 - 1.0221354166666681e-18im, -1.1800733024691392e-18 - 8.85054976851854e-19im, 1.5913835152116374e-18 + 3.1827670304232737e-18im, 0.0 + 0.0im, -1.5913835152116374e-18 + 3.1827670304232737e-18im, -1.1800733024691392e-18 + 8.85054976851854e-19im, 5.621744791666671e-18 - 1.0221354166666681e-18im, 6.322337962962972e-18 + 1.844015239197533e-18im, 2.298538773148151e-18 + 2.130353009259262e-18im, 2.750909391534395e-19 + 7.3149181547619315e-19im, -1.0489004629629646e-20 + 1.0054976851851883e-19im, -2.8935185185185183e-21 + 4.538346009700186e-21im, 5.808027963789718e-24 + 3.4780350942460546e-24im, -7.812499999999994e-23 - 1.2253534226190493e-22im, 1.3668484157986129e-22 + 1.3102891710069483e-21im, 2.2712053571428575e-21 - 6.039341517857155e-21im, -1.311199854290675e-20 + 1.2152584015376984e-20im, 2.445312500000003e-20 - 7.132161458333344e-21im, -8.998074001736076e-21 - 1.6360134548611065e-21im, -1.3312872023809537e-20 - 9.984654017857154e-21im, 4.541180323040666e-21 + 9.082360646081333e-21im, 0.0 + 0.0im, -4.541180323040666e-21 + 9.082360646081333e-21im, -1.3312872023809537e-20 + 9.984654017857154e-21im, 8.998074001736076e-21 - 1.6360134548611065e-21im, 2.445312500000003e-20 + 7.132161458333344e-21im, 1.311199854290675e-20 + 1.2152584015376984e-20im, 2.2712053571428575e-21 + 6.039341517857155e-21im, -1.3668484157986129e-22 + 1.3102891710069483e-21im, -7.812499999999994e-23 + 1.2253534226190493e-22im, -5.808027963789718e-24 + 3.4780350942460546e-24im, -7.6232782938512e-27 - 5.798193054052366e-28im, 1.5840076264880992e-25 + 9.485550257034661e-26im, -1.0324600168350196e-24 - 1.619364371643026e-24im, 1.1531945430871238e-24 + 1.105476148200761e-23im, 1.3465518043154768e-23 - 3.580603661475252e-23im, -5.548703412472947e-23 + 5.1427007237554135e-23im, 6.463350018037516e-23 - 1.8851437552609444e-23im, 1.9525437127976443e-23 + 3.5500794778138974e-24im, -5.77788323149651e-23 - 4.333412423622383e-23im, 5.356561569940499e-24 + 1.0713123139881006e-23im, 0.0 + 0.0im, -5.356561569940499e-24 + 1.0713123139881006e-23im, -5.77788323149651e-23 + 4.333412423622383e-23im, -1.9525437127976443e-23 + 3.5500794778138974e-24im, 6.463350018037516e-23 + 1.8851437552609444e-23im, 5.548703412472947e-23 + 5.1427007237554135e-23im, 1.3465518043154768e-23 + 3.580603661475252e-23im, -1.1531945430871238e-24 + 1.105476148200761e-23im, -1.0324600168350196e-24 + 1.619364371643026e-24im, -1.5840076264880992e-25 + 9.485550257034661e-26im, -7.6232782938512e-27 + 5.798193054052366e-28im]
weights_2 = ComplexF64[0.0 + 0.0im, 0.0 + 0.0im, 1.0 + 0.0im, 0.0 + 0.0im, 0.0 + 0.0im, -0.005000000000000002 + 0.002500000000000001im, 0.015 + 0.0im, 0.005000000000000002 + 0.002500000000000001im, 0.0 + 0.0im, 0.0 + 0.0im, 1.2500000000000012e-5 - 1.6666666666666674e-5im, -0.00010000000000000006 + 5.000000000000003e-5im, 0.00010833333333333327 + 0.0im, 0.00010000000000000006 + 5.000000000000003e-5im, 1.2500000000000012e-5 + 1.6666666666666674e-5im, 0.0 + 0.0im, 0.0 + 0.0im, -1.0416666666666685e-8 + 5.7291666666666745e-8im, 2.812500000000002e-7 - 3.7500000000000017e-7im, -9.687500000000003e-7 + 4.843750000000001e-7im, 1.8749999999999924e-7 + 0.0im, 9.687500000000003e-7 + 4.843750000000001e-7im, 2.812500000000002e-7 + 3.7500000000000017e-7im, 1.0416666666666685e-8 + 5.7291666666666745e-8im, 0.0 + 0.0im, 0.0 + 0.0im, -3.645833333333341e-11 - 1.250000000000003e-10im, -2.500000000000002e-10 + 1.3750000000000007e-9im, 3.0625000000000018e-9 - 4.083333333333336e-9im, -5.2500000000000015e-9 + 2.6250000000000008e-9im, -3.7187500000000064e-9 + 0.0im, 5.2500000000000015e-9 + 2.6250000000000008e-9im, 3.0625000000000018e-9 + 4.083333333333336e-9im, 2.500000000000002e-10 + 1.3750000000000007e-9im, -3.645833333333341e-11 + 1.250000000000003e-10im, 0.0 + 0.0im, 0.0 + 0.0im, 1.6493055555555618e-13 + 1.7795138888888932e-13im, -9.114583333333346e-13 - 3.125000000000006e-12im, -2.907986111111119e-12 + 1.599392361111115e-11im, 2.0312500000000004e-11 - 2.7083333333333334e-11im, -1.1545138888888888e-11 + 5.772569444444444e-12im, -4.046875000000002e-11 + 0.0im, 1.1545138888888888e-11 + 5.772569444444444e-12im, 2.0312500000000004e-11 + 2.7083333333333334e-11im, 2.907986111111119e-12 + 1.599392361111115e-11im, -9.114583333333346e-13 + 3.125000000000006e-12im, -1.6493055555555618e-13 + 1.7795138888888932e-13im, 0.0 + 0.0im, 0.0 + 0.0im, -3.627232142857149e-16 - 1.3640873015873046e-16im, 4.241071428571445e-15 + 4.575892857142869e-15im, -1.1067708333333349e-14 - 3.7946428571428636e-14im, -2.12053571428572e-14 + 1.1662946428571454e-13im, 8.384486607142875e-14 - 1.1179315476190498e-13im, 5.6696428571428594e-14 - 2.8348214285714297e-14im, -2.146701388888889e-13 + 0.0im, -5.6696428571428594e-14 - 2.8348214285714297e-14im, 8.384486607142875e-14 + 1.1179315476190498e-13im, 2.12053571428572e-14 + 1.1662946428571454e-13im, -1.1067708333333349e-14 + 3.7946428571428636e-14im, -4.241071428571445e-15 + 4.575892857142869e-15im, -3.627232142857149e-16 + 1.3640873015873046e-16im, 0.0 + 0.0im, 0.0 + 0.0im, 5.386594742063502e-19 - 5.619109623015824e-20im, -9.521484375000029e-18 - 3.58072916666668e-18im, 5.308702256944467e-17 + 5.727810329861126e-17im, -8.544921875000009e-17 - 2.929687500000004e-16im, -1.045735677083335e-16 + 5.751546223958339e-16im, 1.618652343750001e-16 - 2.1582031250000004e-16im, 6.556260850694454e-16 - 3.278130425347227e-16im, -6.278366815476184e-16 + 0.0im, -6.556260850694454e-16 - 3.278130425347227e-16im, 1.618652343750001e-16 + 2.1582031250000004e-16im, 1.045735677083335e-16 + 5.751546223958339e-16im, -8.544921875000009e-17 + 2.929687500000004e-16im, -5.308702256944467e-17 + 5.727810329861126e-17im, -9.521484375000029e-18 + 3.58072916666668e-18im, -5.386594742063502e-19 - 5.619109623015824e-20im, 0.0 + 0.0im, 0.0 + 0.0im, -5.672932512125255e-22 + 3.6168981481481694e-22im, 1.4364252645502657e-20 - 1.4984292328042185e-21im, -1.2191530257936541e-19 - 4.584848985890667e-20im, 4.2607060185185297e-19 + 4.597077546296302e-19im, -4.610038097993824e-19 - 1.5805844907407403e-18im, -3.4071180555555596e-19 + 1.873914930555557e-18im, -4.425274884259278e-19 + 5.900366512345702e-19im, 3.1827670304232833e-18 - 1.5913835152116416e-18im, -2.716053688547128e-19 + 0.0im, -3.1827670304232833e-18 - 1.5913835152116416e-18im, -4.425274884259278e-19 - 5.900366512345702e-19im, 3.4071180555555596e-19 + 1.873914930555557e-18im, -4.610038097993824e-19 + 1.5805844907407403e-18im, -4.2607060185185297e-19 + 4.597077546296302e-19im, -1.2191530257936541e-19 + 4.584848985890667e-20im, -1.4364252645502657e-20 - 1.4984292328042185e-21im, -5.672932512125255e-22 - 3.6168981481481694e-22im, 0.0 + 0.0im, 0.0 + 0.0im, 3.8644834380511364e-25 - 6.453364404210751e-25im, -1.531691778273814e-23 + 9.765625000000024e-24im, 1.8718416728670722e-22 - 1.9526405939980042e-23im, -1.0065569196428603e-21 - 3.785342261904774e-22im, 2.4305168030754038e-21 + 2.6223997085813528e-21im, -1.783040364583333e-21 - 6.113281250000001e-21im, -5.453378182870358e-22 + 2.9993580005786955e-21im, -4.992327008928588e-21 + 6.656436011904783e-21im, 9.082360646081339e-21 - 4.5411803230406695e-21im, 7.142101469494068e-21 + 0.0im, -9.082360646081339e-21 - 4.5411803230406695e-21im, -4.992327008928588e-21 - 6.656436011904783e-21im, 5.453378182870358e-22 + 2.9993580005786955e-21im, -1.783040364583333e-21 + 6.113281250000001e-21im, -2.4305168030754038e-21 + 2.6223997085813528e-21im, -1.0065569196428603e-21 + 3.785342261904774e-22im, -1.8718416728670722e-22 - 1.9526405939980042e-23im, -1.531691778273814e-23 - 9.765625000000024e-24im, -3.8644834380511364e-25 - 6.453364404210751e-25im, 0.0 + 0.0im]
translated_weights_1 = ComplexF64[0.0 + 0.0im, -0.010000000000000004 - 0.010000000000000002im, 9.75781955236954e-19 - 3.469446951953614e-18im, 0.010000000000000004 - 0.010000000000000002im, 0.0002666666666666667 + 3.3881317890172014e-21im, -0.00013333333333333329 - 0.00013333333333333329im, -6.776263578034403e-20 + 8.131516293641283e-20im, 0.0001333333333333334 - 0.0001333333333333335im, 0.0002666666666666669 + 3.748120791600279e-20im, -2.000000000000002e-6 + 2.0000000000000008e-6im, 4.000000000000001e-6 + 1.5352472168984194e-21im, 9.99999999999999e-7 + 1.0000000000000048e-6im, -2.329340604949326e-21 + 2.117582368135751e-21im, -9.999999999999966e-7 + 9.999999999999968e-7im, 4.000000000000006e-6 - 6.352747104407253e-22im, 2.000000000000003e-6 + 2.0000000000000008e-6im, 6.591595506281939e-25 - 2.133333333333335e-8im, -3.200000000000017e-8 + 3.20000000000001e-8im, -1.0666666666666666e-8 + 2.9778502051908996e-23im, 2.6666666666666654e-8 + 2.666666666666666e-8im, -1.3234889800848443e-23 + 1.9852334701272664e-23im, -2.666666666666682e-8 + 2.6666666666666657e-8im, -1.0666666666666828e-8 + 1.0091603473146938e-22im, 3.200000000000013e-8 + 3.200000000000003e-8im, -8.220107337245713e-24 + 2.1333333333333395e-8im, 8.888888888888893e-11 + 8.888888888888894e-11im, 7.760876694436732e-25 - 3.555555555555566e-10im, -6.914712933060466e-25 + 1.5049194152209869e-24im, -5.333333333333351e-10 - 8.659547037664508e-25im, 6.666666666666791e-11 + 6.666666666666719e-11im, 1.4992648602523627e-24 - 3.812785635986612e-25im, -6.666666666666711e-11 + 6.666666666666677e-11im, -5.333333333333353e-10 - 5.945360652724886e-25im, 7.560947786617519e-25 + 1.2767177325586526e-24im, 4.669046816949707e-25 + 3.5555555555555643e-10im, -8.888888888888911e-11 + 8.88888888888891e-11im, -6.095238095238098e-13 - 6.138816956816761e-28im, 1.5238095238095258e-12 + 1.5238095238095297e-12im, -6.269866474696602e-27 - 6.095238095238131e-13im, 3.0476190476190512e-12 - 3.0476190476190512e-12im, -2.2857142857142936e-12 + 1.772097137488481e-26im, -1.6000000000000202e-12 - 1.5999999999999788e-12im, 1.9185097214975007e-27 + 1.4395133798473023e-26im, 1.6000000000000283e-12 - 1.5999999999999855e-12im, -2.28571428571429e-12 - 1.0097419586828951e-28im, -3.0476190476190415e-12 - 3.0476190476190605e-12im, -6.777892897658933e-27 + 6.095238095238126e-13im, -1.5238095238095244e-12 + 1.5238095238095282e-12im, -6.095238095238108e-13 + 4.924464200842166e-28im, 1.7777777777777913e-15 - 1.777777777777786e-15im, -1.0666666666666685e-14 + 1.5948060127549536e-29im, 4.4444444444444724e-15 + 4.4444444444444385e-15im, 9.240765947565509e-29 + 2.4888888888889083e-14im, 1.7333333333333554e-14 - 1.733333333333345e-14im, 2.0444444444444654e-14 - 1.843962365954115e-28im, -1.1333333333333409e-14 - 1.133333333333359e-14im, -1.9248206087392688e-28 - 8.223874936929048e-29im, 1.1333333333333185e-14 - 1.1333333333333703e-14im, 2.0444444444444556e-14 + 2.082592789783471e-28im, -1.7333333333333535e-14 - 1.7333333333333434e-14im, 1.1438483125704671e-28 - 2.4888888888889077e-14im, -4.444444444444484e-15 + 4.44444444444448e-15im, -1.0666666666666709e-14 - 1.442752639939366e-29im, -1.77777777777779e-15 - 1.777777777777783e-15im, -5.1207237558825735e-33 + 9.029982363315745e-18im, 3.160493827160488e-17 - 3.1604938271604933e-17im, -4.063492063492046e-17 + 7.51714531418643e-33im, -7.901234567901276e-17 - 7.901234567901165e-17im, -1.1795117203156578e-31 + 1.7382716049382675e-16im, -7.111111111111054e-17 + 7.11111111111131e-17im, 1.9753086419752946e-16 + 7.588163980885709e-31im, 2.3139329805998497e-17 + 2.3139329805996327e-17im, 2.6377536518327582e-30 + 3.420451581231731e-31im, -2.3139329805997384e-17 + 2.313932980599447e-17im, 1.9753086419752956e-16 - 1.4051584874249273e-30im, 7.111111111110999e-17 + 7.111111111111242e-17im, -5.677641476053571e-31 - 1.7382716049382742e-16im, 7.901234567901292e-17 - 7.901234567901194e-17im, -4.063492063492057e-17 + 2.0222264416065976e-33im, -3.1604938271604816e-17 - 3.160493827160493e-17im, -7.238788251911712e-33 - 9.029982363315752e-18im, -2.031746031746037e-20 - 2.0317460317460373e-20im, -4.5184533477670204e-35 + 1.6253968253968245e-19im, 1.422222222222222e-19 - 1.422222222222223e-19im, 4.063492063492016e-19 - 3.62697606451866e-33im, -6.603174603174586e-19 - 6.603174603174626e-19im, -8.614492800566052e-33 - 2.8444444444444503e-19im, -9.955555555555507e-19 + 9.955555555555505e-19im, 2.0317460317446428e-20 + 4.8373943525038776e-33im, 4.965079365079271e-19 + 4.965079365079335e-19im, 2.69028339106592e-33 + 7.318533788671496e-33im, -4.9650793650794125e-19 + 4.965079365079392e-19im, 2.0317460317454755e-20 - 5.729641584552027e-33im, 9.955555555555459e-19 + 9.955555555555515e-19im, -7.78496994707778e-33 + 2.8444444444445356e-19im, 6.603174603174584e-19 - 6.6031746031746255e-19im, 4.0634920634920797e-19 + 1.9018558200823954e-33im, -1.4222222222222353e-19 - 1.422222222222225e-19im, -3.1832387020267546e-35 - 1.6253968253968262e-19im, 2.031746031746037e-20 - 2.0317460317460367e-20im, 8.209074875741541e-23 + 3.032001370270584e-37im, -3.6940836940837076e-22 - 3.6940836940837185e-22im, 1.1888018881874314e-36 + 8.209074875741439e-22im, -8.6195286195287e-22 + 8.61952861952874e-22im, 4.063492063492024e-21 - 5.380641719896705e-37im, 6.156806156810189e-23 + 6.156806156804637e-23im, 4.087855073381431e-35 - 7.265031265031235e-21im, -1.4776334776334774e-21 + 1.4776334776334317e-21im, -5.987493987493935e-21 - 3.741745455461194e-35im, 1.0440917107583548e-21 + 1.0440917107583512e-21im, 7.720059149025373e-35 - 4.3446271206391746e-35im, -1.0440917107583439e-21 + 1.0440917107583967e-21im, -5.987493987493985e-21 - 7.349190681340941e-35im, 1.4776334776335487e-21 + 1.4776334776334475e-21im, -1.1355275428943297e-35 + 7.265031265031218e-21im, -6.156806156807854e-23 + 6.156806156803687e-23im, 4.063492063492045e-21 + 3.764520658508376e-36im, 8.619528619528584e-22 + 8.619528619528704e-22im, 2.4474159726104658e-36 - 8.209074875741589e-22im, 3.6940836940837025e-22 - 3.6940836940836982e-22im, 8.209074875741601e-23 - 1.7580470809819949e-37im]
translated_weights_2 = ComplexF64[0.0 + 0.0im, 8.326672684688674e-17 - 1.3877787807814457e-16im, 0.9999999999999998 + 0.0im, -5.551115123125783e-17 - 5.551115123125783e-17im, 1.6263032587282567e-19 + 3.577867169202165e-18im, -0.010000000000000004 + 0.010000000000000002im, 0.009999999999999988 + 6.505213034913027e-19im, 0.010000000000000004 + 0.010000000000000002im, -1.1926223897340549e-18 + 3.469446951953614e-18im, -4.531626267810507e-20 - 2.6469779601696886e-21im, 3.3881317890172014e-21 - 0.00013333333333333345im, -0.00013333333333333345 + 0.00013333333333333342im, -0.00020000000000000004 + 2.710505431213761e-20im, 0.0001333333333333335 + 0.0001333333333333335im, 2.371692252312041e-20 + 0.0001333333333333335im, 5.082197683525802e-21 + 1.6940658945086007e-21im, 4.517957108188068e-22 - 4.466775307786349e-22im, 6.666666666666681e-7 + 6.666666666666681e-7im, 5.161607022330893e-22 - 2.000000000000006e-6im, 9.99999999999998e-7 - 9.99999999999999e-7im, -3.66666666666668e-6 - 2.117582368135751e-22im, -1.0e-6 - 9.999999999999978e-7im, 1.0323214044661785e-21 + 2.000000000000004e-6im, -6.666666666666679e-7 + 6.66666666666668e-7im, -4.896909226313924e-22 - 3.019209235818551e-23im, 2.3240220921045514e-24 + 2.2410213031008174e-24im, -5.3333333333333505e-9 + 9.092524389547734e-24im, 1.0666666666666684e-8 + 1.0666666666666722e-8im, -1.8404768629304866e-23 + 5.333333333333384e-9im, 2.6666666666666753e-8 - 2.6666666666666717e-8im, 1.3333333333332524e-9 + 1.1166938269465874e-23im, -2.6666666666666697e-8 - 2.6666666666666717e-8im, -2.481541837659083e-23 - 5.333333333333317e-9im, -1.0666666666666674e-8 + 1.0666666666666713e-8im, -5.333333333333344e-9 + 8.788794008375919e-25im, 3.0373038117181485e-25 - 4.8467614016778965e-26im, -3.170274205902202e-26 - 1.1160804087066875e-26im, 1.7777777777777782e-11 - 1.777777777777784e-11im, -8.888888888888917e-11 + 1.0142857974969681e-25im, 1.4085900323626387e-25 + 8.643391166325582e-26im, 1.857925203976527e-26 + 2.666666666666674e-10im, 6.666666666666685e-11 - 6.666666666666708e-11im, 3.6000000000000077e-10 + 3.021147940379222e-25im, -6.666666666666659e-11 - 6.666666666666684e-11im, 1.8256134612986744e-25 - 2.6666666666666756e-10im, -2.5566666393850904e-25 - 1.1147551223859162e-25im, -8.888888888888915e-11 + 6.421958857223213e-26im, -1.777777777777783e-11 - 1.7777777777777772e-11im, 1.8932661725304283e-28 - 1.3921817255340416e-26im, -5.534660436982263e-29 - 1.1859876597536598e-29im, -3.002293671706374e-29 + 1.0158730158730225e-13im, 3.0476190476190596e-13 - 3.047619047619063e-13im, -1.5238095238095114e-13 + 1.0282801899555889e-27im, -1.0158730158730278e-12 - 1.0158730158730225e-12im, 3.003982327081613e-27 + 1.1428571428571434e-12im, -1.6000000000000186e-12 + 1.6000000000000237e-12im, 1.7904761904761844e-12 + 2.145701662201152e-28im, 1.6000000000000245e-12 + 1.6000000000000249e-12im, 7.068193710780266e-28 - 1.1428571428571421e-12im, 1.0158730158730302e-12 - 1.015873015873025e-12im, -1.523809523809525e-13 - 1.3536853133592563e-27im, -3.0476190476190616e-13 - 3.047619047619068e-13im, -2.1989497733035704e-28 - 1.0158730158730211e-13im, 9.843504982960938e-29 - 2.4010953802664547e-29im, 4.476440474372021e-31 - 1.1989045559177835e-31im, -2.539682539682553e-16 - 2.5396825396825442e-16im, 2.3279678202780713e-30 + 1.7777777777777787e-15im, 8.888888888888949e-16 - 8.888888888888864e-16im, 6.2222222222222456e-15 - 4.0347461962934836e-29im, -5.777777777777767e-15 - 5.777777777777794e-15im, -8.797647985960893e-29 - 1.0222222222222352e-14im, -1.1333333333333352e-14 + 1.1333333333333311e-14im, -1.1523809523809826e-14 + 1.6097692847166272e-29im, 1.1333333333333359e-14 + 1.1333333333333311e-14im, -1.001853349630685e-28 + 1.0222222222222386e-14im, 5.777777777777766e-15 - 5.7777777777778106e-15im, 6.222222222222265e-15 + 4.886007231712642e-29im, -8.888888888888878e-16 - 8.888888888888856e-16im, 6.1722202857722135e-30 - 1.7777777777777795e-15im, 2.5396825396825442e-16 - 2.53968253968255e-16im, 3.843193204024729e-31 + 4.024230618797129e-31im, 1.3021685608027743e-34 + 6.732210430792786e-34im, 1.1287477954144588e-18 - 1.1492455619684258e-33im, -4.514991181657854e-18 - 4.514991181657868e-18im, 8.881847235717073e-33 + 6.772486772486801e-18im, -1.5802469135802417e-17 + 1.5802469135802538e-17im, 4.34567901234566e-17 - 9.199174286710251e-32im, 2.370370370370412e-17 + 2.370370370370335e-17im, -4.6017688608702517e-32 - 9.876543209876468e-17im, 2.3139329805996512e-17 - 2.3139329805997168e-17im, -1.2634920634920512e-16 - 3.534081447950578e-32im, -2.3139329805996768e-17 - 2.3139329805997184e-17im, 1.6832627713944441e-31 + 9.876543209876455e-17im, -2.3703703703704318e-17 + 2.3703703703703717e-17im, 4.345679012345649e-17 - 1.0438540298578818e-31im, 1.5802469135802467e-17 + 1.5802469135802676e-17im, -2.6493573797476913e-32 - 6.7724867724867265e-18im, 4.514991181657865e-18 - 4.514991181657856e-18im, 1.1287477954144698e-18 - 1.960536498075444e-33im, 7.431005088158173e-34 + 1.7642304108560605e-33im, -2.293032432089728e-36 + 3.0593727874392005e-36im, -2.257495590828941e-21 + 2.257495590828906e-21im, 2.0317460317460406e-20 + 4.5317970453587765e-35im, -2.031746031746047e-20 - 2.0317460317460084e-20im, -2.7528608328319446e-34 - 6.772486772486812e-20im, -1.3206349206349243e-19 + 1.320634920634931e-19im, -7.11111111111133e-20 + 1.6727637260506398e-33im, 3.318518518518534e-19 + 3.318518518518524e-19im, 3.159011763456307e-33 - 1.0158730158726295e-20im, 4.96507936507939e-19 - 4.96507936507937e-19im, -6.758377425043614e-20 - 6.752039551123219e-35im, -4.965079365079359e-19 - 4.965079365079375e-19im, 3.114589831938733e-33 + 1.0158730158726572e-20im, -3.3185185185185187e-19 + 3.318518518518505e-19im, -7.111111111111439e-20 - 1.0607661021820322e-33im, 1.3206349206349289e-19 + 1.320634920634925e-19im, -6.354252262804957e-34 + 6.772486772486827e-20im, 2.03174603174606e-20 - 2.0317460317460328e-20im, 2.03174603174604e-20 + 3.9320286035005517e-35im, 2.2574955908289427e-21 + 2.2574955908289258e-21im, -3.9975991477573574e-37 - 5.5653229026704254e-36im]

expansion_order = 10

# create branches
center = SVector{3}([0.01, 0.02, -0.03])
box = SVector{3}(0.0,0.0,0.0)

branch = Branch(1:1, 0, 1:0, 0, 1, center, center, 0.0, 0.0, box, box)
branch_weights = initialize_expansion(expansion_order)
translated_center = SVector{3}([0.04, 0.04, -0.019999999999999997])
translated_branch = Branch(1:1, 0, 1:0, 0, 1, translated_center, translated_center, 0.0, 0.0, box, box)
translated_weights = initialize_expansion(expansion_order)

# set source expansion
i, i_compressed = 1, 1
for n in 0:expansion_order
    for m in -n:n
        if m >= 0
            branch_weights[1,1,i_compressed] = real(weights_1[i])
            branch_weights[2,1,i_compressed] = imag(weights_1[i])
            branch_weights[1,2,i_compressed] = real(weights_2[i])
            branch_weights[2,2,i_compressed] = imag(weights_2[i])
            i_compressed += 1
        end
        i += 1
    end
end

# preallocate containers
Hs_π2 = [1.0]
FastMultipole.update_Hs_π2!(Hs_π2, expansion_order)
Ts = zeros(FastMultipole.length_Ts(expansion_order))
eimϕs = zeros(2, expansion_order+2)
weights_tmp_1 = initialize_expansion(expansion_order, eltype(Ts))
weights_tmp_2 = initialize_expansion(expansion_order, eltype(Ts))

# normalization
ζs_mag = zeros(FastMultipole.length_ζs(expansion_order))
FastMultipole.update_ζs_mag!(ζs_mag, 0, expansion_order)

lamb_helmholtz = Val(true)

FastMultipole.multipole_to_multipole!(translated_weights, translated_branch, branch_weights, branch, weights_tmp_1, weights_tmp_2, Ts, eimϕs, ζs_mag, Hs_π2, expansion_order, lamb_helmholtz)

# test result
i, i_compressed = 1, 1
for n in 0:expansion_order
    for m in -n:n
        if m >= 0
            @test isapprox(translated_weights[1,1,i_compressed], real(translated_weights_1[i]); atol=1e-12)
            @test isapprox(translated_weights[2,1,i_compressed], imag(translated_weights_1[i]); atol=1e-12)
            @test isapprox(translated_weights[1,2,i_compressed], real(translated_weights_2[i]); atol=1e-12)
            @test isapprox(translated_weights[2,2,i_compressed], imag(translated_weights_2[i]); atol=1e-12)
            i_compressed += 1
        end
        i += 1
    end
end

end

@testset "Lamb-Helmholtz transform: multipole-to-local" begin

weights_1 = ComplexF64[0.0 + 0.0im, -0.010000000000000004 - 0.010000000000000002im, 9.75781955236954e-19 - 3.469446951953614e-18im, 0.010000000000000004 - 0.010000000000000002im, 0.0002666666666666667 + 3.3881317890172014e-21im, -0.00013333333333333329 - 0.00013333333333333329im, -6.776263578034403e-20 + 8.131516293641283e-20im, 0.0001333333333333334 - 0.0001333333333333335im, 0.0002666666666666669 + 3.748120791600279e-20im, -2.000000000000002e-6 + 2.0000000000000008e-6im, 4.000000000000001e-6 + 1.5352472168984194e-21im, 9.99999999999999e-7 + 1.0000000000000048e-6im, -2.329340604949326e-21 + 2.117582368135751e-21im, -9.999999999999966e-7 + 9.999999999999968e-7im, 4.000000000000006e-6 - 6.352747104407253e-22im, 2.000000000000003e-6 + 2.0000000000000008e-6im, 6.591595506281939e-25 - 2.133333333333335e-8im, -3.200000000000017e-8 + 3.20000000000001e-8im, -1.0666666666666666e-8 + 2.9778502051908996e-23im, 2.6666666666666654e-8 + 2.666666666666666e-8im, -1.3234889800848443e-23 + 1.9852334701272664e-23im, -2.666666666666682e-8 + 2.6666666666666657e-8im, -1.0666666666666828e-8 + 1.0091603473146938e-22im, 3.200000000000013e-8 + 3.200000000000003e-8im, -8.220107337245713e-24 + 2.1333333333333395e-8im, 8.888888888888893e-11 + 8.888888888888894e-11im, 7.760876694436732e-25 - 3.555555555555566e-10im, -6.914712933060466e-25 + 1.5049194152209869e-24im, -5.333333333333351e-10 - 8.659547037664508e-25im, 6.666666666666791e-11 + 6.666666666666719e-11im, 1.4992648602523627e-24 - 3.812785635986612e-25im, -6.666666666666711e-11 + 6.666666666666677e-11im, -5.333333333333353e-10 - 5.945360652724886e-25im, 7.560947786617519e-25 + 1.2767177325586526e-24im, 4.669046816949707e-25 + 3.5555555555555643e-10im, -8.888888888888911e-11 + 8.88888888888891e-11im, -6.095238095238098e-13 - 6.138816956816761e-28im, 1.5238095238095258e-12 + 1.5238095238095297e-12im, -6.269866474696602e-27 - 6.095238095238131e-13im, 3.0476190476190512e-12 - 3.0476190476190512e-12im, -2.2857142857142936e-12 + 1.772097137488481e-26im, -1.6000000000000202e-12 - 1.5999999999999788e-12im, 1.9185097214975007e-27 + 1.4395133798473023e-26im, 1.6000000000000283e-12 - 1.5999999999999855e-12im, -2.28571428571429e-12 - 1.0097419586828951e-28im, -3.0476190476190415e-12 - 3.0476190476190605e-12im, -6.777892897658933e-27 + 6.095238095238126e-13im, -1.5238095238095244e-12 + 1.5238095238095282e-12im, -6.095238095238108e-13 + 4.924464200842166e-28im, 1.7777777777777913e-15 - 1.777777777777786e-15im, -1.0666666666666685e-14 + 1.5948060127549536e-29im, 4.4444444444444724e-15 + 4.4444444444444385e-15im, 9.240765947565509e-29 + 2.4888888888889083e-14im, 1.7333333333333554e-14 - 1.733333333333345e-14im, 2.0444444444444654e-14 - 1.843962365954115e-28im, -1.1333333333333409e-14 - 1.133333333333359e-14im, -1.9248206087392688e-28 - 8.223874936929048e-29im, 1.1333333333333185e-14 - 1.1333333333333703e-14im, 2.0444444444444556e-14 + 2.082592789783471e-28im, -1.7333333333333535e-14 - 1.7333333333333434e-14im, 1.1438483125704671e-28 - 2.4888888888889077e-14im, -4.444444444444484e-15 + 4.44444444444448e-15im, -1.0666666666666709e-14 - 1.442752639939366e-29im, -1.77777777777779e-15 - 1.777777777777783e-15im, -5.1207237558825735e-33 + 9.029982363315745e-18im, 3.160493827160488e-17 - 3.1604938271604933e-17im, -4.063492063492046e-17 + 7.51714531418643e-33im, -7.901234567901276e-17 - 7.901234567901165e-17im, -1.1795117203156578e-31 + 1.7382716049382675e-16im, -7.111111111111054e-17 + 7.11111111111131e-17im, 1.9753086419752946e-16 + 7.588163980885709e-31im, 2.3139329805998497e-17 + 2.3139329805996327e-17im, 2.6377536518327582e-30 + 3.420451581231731e-31im, -2.3139329805997384e-17 + 2.313932980599447e-17im, 1.9753086419752956e-16 - 1.4051584874249273e-30im, 7.111111111110999e-17 + 7.111111111111242e-17im, -5.677641476053571e-31 - 1.7382716049382742e-16im, 7.901234567901292e-17 - 7.901234567901194e-17im, -4.063492063492057e-17 + 2.0222264416065976e-33im, -3.1604938271604816e-17 - 3.160493827160493e-17im, -7.238788251911712e-33 - 9.029982363315752e-18im, -2.031746031746037e-20 - 2.0317460317460373e-20im, -4.5184533477670204e-35 + 1.6253968253968245e-19im, 1.422222222222222e-19 - 1.422222222222223e-19im, 4.063492063492016e-19 - 3.62697606451866e-33im, -6.603174603174586e-19 - 6.603174603174626e-19im, -8.614492800566052e-33 - 2.8444444444444503e-19im, -9.955555555555507e-19 + 9.955555555555505e-19im, 2.0317460317446428e-20 + 4.8373943525038776e-33im, 4.965079365079271e-19 + 4.965079365079335e-19im, 2.69028339106592e-33 + 7.318533788671496e-33im, -4.9650793650794125e-19 + 4.965079365079392e-19im, 2.0317460317454755e-20 - 5.729641584552027e-33im, 9.955555555555459e-19 + 9.955555555555515e-19im, -7.78496994707778e-33 + 2.8444444444445356e-19im, 6.603174603174584e-19 - 6.6031746031746255e-19im, 4.0634920634920797e-19 + 1.9018558200823954e-33im, -1.4222222222222353e-19 - 1.422222222222225e-19im, -3.1832387020267546e-35 - 1.6253968253968262e-19im, 2.031746031746037e-20 - 2.0317460317460367e-20im, 8.209074875741541e-23 + 3.032001370270584e-37im, -3.6940836940837076e-22 - 3.6940836940837185e-22im, 1.1888018881874314e-36 + 8.209074875741439e-22im, -8.6195286195287e-22 + 8.61952861952874e-22im, 4.063492063492024e-21 - 5.380641719896705e-37im, 6.156806156810189e-23 + 6.156806156804637e-23im, 4.087855073381431e-35 - 7.265031265031235e-21im, -1.4776334776334774e-21 + 1.4776334776334317e-21im, -5.987493987493935e-21 - 3.741745455461194e-35im, 1.0440917107583548e-21 + 1.0440917107583512e-21im, 7.720059149025373e-35 - 4.3446271206391746e-35im, -1.0440917107583439e-21 + 1.0440917107583967e-21im, -5.987493987493985e-21 - 7.349190681340941e-35im, 1.4776334776335487e-21 + 1.4776334776334475e-21im, -1.1355275428943297e-35 + 7.265031265031218e-21im, -6.156806156807854e-23 + 6.156806156803687e-23im, 4.063492063492045e-21 + 3.764520658508376e-36im, 8.619528619528584e-22 + 8.619528619528704e-22im, 2.4474159726104658e-36 - 8.209074875741589e-22im, 3.6940836940837025e-22 - 3.6940836940836982e-22im, 8.209074875741601e-23 - 1.7580470809819949e-37im]
weights_2 = ComplexF64[0.0 + 0.0im, 8.326672684688674e-17 - 1.3877787807814457e-16im, 0.9999999999999998 + 0.0im, -5.551115123125783e-17 - 5.551115123125783e-17im, 1.6263032587282567e-19 + 3.577867169202165e-18im, -0.010000000000000004 + 0.010000000000000002im, 0.009999999999999988 + 6.505213034913027e-19im, 0.010000000000000004 + 0.010000000000000002im, -1.1926223897340549e-18 + 3.469446951953614e-18im, -4.531626267810507e-20 - 2.6469779601696886e-21im, 3.3881317890172014e-21 - 0.00013333333333333345im, -0.00013333333333333345 + 0.00013333333333333342im, -0.00020000000000000004 + 2.710505431213761e-20im, 0.0001333333333333335 + 0.0001333333333333335im, 2.371692252312041e-20 + 0.0001333333333333335im, 5.082197683525802e-21 + 1.6940658945086007e-21im, 4.517957108188068e-22 - 4.466775307786349e-22im, 6.666666666666681e-7 + 6.666666666666681e-7im, 5.161607022330893e-22 - 2.000000000000006e-6im, 9.99999999999998e-7 - 9.99999999999999e-7im, -3.66666666666668e-6 - 2.117582368135751e-22im, -1.0e-6 - 9.999999999999978e-7im, 1.0323214044661785e-21 + 2.000000000000004e-6im, -6.666666666666679e-7 + 6.66666666666668e-7im, -4.896909226313924e-22 - 3.019209235818551e-23im, 2.3240220921045514e-24 + 2.2410213031008174e-24im, -5.3333333333333505e-9 + 9.092524389547734e-24im, 1.0666666666666684e-8 + 1.0666666666666722e-8im, -1.8404768629304866e-23 + 5.333333333333384e-9im, 2.6666666666666753e-8 - 2.6666666666666717e-8im, 1.3333333333332524e-9 + 1.1166938269465874e-23im, -2.6666666666666697e-8 - 2.6666666666666717e-8im, -2.481541837659083e-23 - 5.333333333333317e-9im, -1.0666666666666674e-8 + 1.0666666666666713e-8im, -5.333333333333344e-9 + 8.788794008375919e-25im, 3.0373038117181485e-25 - 4.8467614016778965e-26im, -3.170274205902202e-26 - 1.1160804087066875e-26im, 1.7777777777777782e-11 - 1.777777777777784e-11im, -8.888888888888917e-11 + 1.0142857974969681e-25im, 1.4085900323626387e-25 + 8.643391166325582e-26im, 1.857925203976527e-26 + 2.666666666666674e-10im, 6.666666666666685e-11 - 6.666666666666708e-11im, 3.6000000000000077e-10 + 3.021147940379222e-25im, -6.666666666666659e-11 - 6.666666666666684e-11im, 1.8256134612986744e-25 - 2.6666666666666756e-10im, -2.5566666393850904e-25 - 1.1147551223859162e-25im, -8.888888888888915e-11 + 6.421958857223213e-26im, -1.777777777777783e-11 - 1.7777777777777772e-11im, 1.8932661725304283e-28 - 1.3921817255340416e-26im, -5.534660436982263e-29 - 1.1859876597536598e-29im, -3.002293671706374e-29 + 1.0158730158730225e-13im, 3.0476190476190596e-13 - 3.047619047619063e-13im, -1.5238095238095114e-13 + 1.0282801899555889e-27im, -1.0158730158730278e-12 - 1.0158730158730225e-12im, 3.003982327081613e-27 + 1.1428571428571434e-12im, -1.6000000000000186e-12 + 1.6000000000000237e-12im, 1.7904761904761844e-12 + 2.145701662201152e-28im, 1.6000000000000245e-12 + 1.6000000000000249e-12im, 7.068193710780266e-28 - 1.1428571428571421e-12im, 1.0158730158730302e-12 - 1.015873015873025e-12im, -1.523809523809525e-13 - 1.3536853133592563e-27im, -3.0476190476190616e-13 - 3.047619047619068e-13im, -2.1989497733035704e-28 - 1.0158730158730211e-13im, 9.843504982960938e-29 - 2.4010953802664547e-29im, 4.476440474372021e-31 - 1.1989045559177835e-31im, -2.539682539682553e-16 - 2.5396825396825442e-16im, 2.3279678202780713e-30 + 1.7777777777777787e-15im, 8.888888888888949e-16 - 8.888888888888864e-16im, 6.2222222222222456e-15 - 4.0347461962934836e-29im, -5.777777777777767e-15 - 5.777777777777794e-15im, -8.797647985960893e-29 - 1.0222222222222352e-14im, -1.1333333333333352e-14 + 1.1333333333333311e-14im, -1.1523809523809826e-14 + 1.6097692847166272e-29im, 1.1333333333333359e-14 + 1.1333333333333311e-14im, -1.001853349630685e-28 + 1.0222222222222386e-14im, 5.777777777777766e-15 - 5.7777777777778106e-15im, 6.222222222222265e-15 + 4.886007231712642e-29im, -8.888888888888878e-16 - 8.888888888888856e-16im, 6.1722202857722135e-30 - 1.7777777777777795e-15im, 2.5396825396825442e-16 - 2.53968253968255e-16im, 3.843193204024729e-31 + 4.024230618797129e-31im, 1.3021685608027743e-34 + 6.732210430792786e-34im, 1.1287477954144588e-18 - 1.1492455619684258e-33im, -4.514991181657854e-18 - 4.514991181657868e-18im, 8.881847235717073e-33 + 6.772486772486801e-18im, -1.5802469135802417e-17 + 1.5802469135802538e-17im, 4.34567901234566e-17 - 9.199174286710251e-32im, 2.370370370370412e-17 + 2.370370370370335e-17im, -4.6017688608702517e-32 - 9.876543209876468e-17im, 2.3139329805996512e-17 - 2.3139329805997168e-17im, -1.2634920634920512e-16 - 3.534081447950578e-32im, -2.3139329805996768e-17 - 2.3139329805997184e-17im, 1.6832627713944441e-31 + 9.876543209876455e-17im, -2.3703703703704318e-17 + 2.3703703703703717e-17im, 4.345679012345649e-17 - 1.0438540298578818e-31im, 1.5802469135802467e-17 + 1.5802469135802676e-17im, -2.6493573797476913e-32 - 6.7724867724867265e-18im, 4.514991181657865e-18 - 4.514991181657856e-18im, 1.1287477954144698e-18 - 1.960536498075444e-33im, 7.431005088158173e-34 + 1.7642304108560605e-33im, -2.293032432089728e-36 + 3.0593727874392005e-36im, -2.257495590828941e-21 + 2.257495590828906e-21im, 2.0317460317460406e-20 + 4.5317970453587765e-35im, -2.031746031746047e-20 - 2.0317460317460084e-20im, -2.7528608328319446e-34 - 6.772486772486812e-20im, -1.3206349206349243e-19 + 1.320634920634931e-19im, -7.11111111111133e-20 + 1.6727637260506398e-33im, 3.318518518518534e-19 + 3.318518518518524e-19im, 3.159011763456307e-33 - 1.0158730158726295e-20im, 4.96507936507939e-19 - 4.96507936507937e-19im, -6.758377425043614e-20 - 6.752039551123219e-35im, -4.965079365079359e-19 - 4.965079365079375e-19im, 3.114589831938733e-33 + 1.0158730158726572e-20im, -3.3185185185185187e-19 + 3.318518518518505e-19im, -7.111111111111439e-20 - 1.0607661021820322e-33im, 1.3206349206349289e-19 + 1.320634920634925e-19im, -6.354252262804957e-34 + 6.772486772486827e-20im, 2.03174603174606e-20 - 2.0317460317460328e-20im, 2.03174603174604e-20 + 3.9320286035005517e-35im, 2.2574955908289427e-21 + 2.2574955908289258e-21im, -3.9975991477573574e-37 - 5.5653229026704254e-36im]

translated_weights_1 = ComplexF64[0.0219171658794426 + 1.733358189231408e-18im, 1.0827776033663565 + 0.03383680010508041im, -8.132627323977414e-13 - 3.3306690738754696e-16im, -1.0827776033663568 + 0.033836800105080424im, -0.21118210923806 + 3.3756140271768924im, -0.03519701820188462 - 0.0010999068254175515im, 1.4065609788005418e-11 + 1.1796119636642288e-16im, 0.0351970182018851 - 0.0010999068254176694im, -0.21118210923806002 - 3.375614027176893im, -17.522234276726905 - 1.6469999227153034im, 0.01525496521011808 - 0.2438410825584145im, -1.1706914459176119 - 0.03658410754233507im, 2.826502530292596e-11 - 2.5587171270657905e-17im, 1.1706914459176079 - 0.036584107542335im, 0.015254965210118413 + 0.24384108255841805im, 17.522234276726916 - 1.6469999227153045im, 15.979530485686961 - 127.21155526517697im, 1.9935362427580594 + 0.18738215894239674im, 0.5703256039635055 - 9.116298356283352im, 0.2857413305289757 + 0.008929416984706605im, -1.5747587347894696e-9 + 7.843118515760139e-16im, -0.2857413305289844 + 0.008929416984706662im, 0.5703256039635106 + 9.116298356283352im, -1.9935362427580765 + 0.18738215894240087im, 15.979530485686952 + 127.21155526517701im, 1186.2535098244596 + 186.81359139051258im, -2.4932847087415806 + 19.848806977671405im, 79.43039843091928 + 7.466048989223858im, -0.20799940096539113 + 3.3247402088054074im, 11.371845548337694 + 0.35537015151988327im, 5.469416012487179e-10 - 3.088578926033897e-14im, -11.37184554833758 + 0.35537015151989093im, -0.20799940096539776 - 3.324740208805434im, -79.4303984309192 + 7.466048989223869im, -2.4932847087416334 - 19.84880697767167im, -1186.253509824462 + 186.81359139051273im, -2561.7241179695957 + 13506.543046108265im, -235.6482941064074 - 37.11036983354065im, -103.39157011919704 + 823.0906737492265im, -38.81961842177087 - 3.6488449713663704im, -8.610277269692707 + 137.6299069494625im, -7.212806931846006 - 0.22540021672708935im, 2.8255669613408456e-7 + 4.355531506208127e-14im, 7.212806931846177 - 0.22540021672712712im, -8.61027726969274 - 137.62990694946262im, 38.81961842177114 - 3.648844971366439im, -103.39157011919744 - 823.0906737492269im, 235.64829410640746 - 37.11036983354106im, -2561.724117969593 - 13506.543046108272im, -181560.93267196638 - 40348.75819797531im, 618.59201950741 - 3261.490541386032im, -10042.309417614455 - 1581.483096397723im, 63.560422704179565 - 505.99849386350286im, -1650.4721375737067 - 155.1358859492022im, 7.230614943276541 - 115.57684010637581im, -306.3048136148472 - 9.572020687951166im, -9.993593403748828e-7 + 5.872456875297008e-13im, 306.3048136148513 - 9.572020687950884im, 7.230614943276854 + 115.57684010637907im, 1650.4721375737195 - 155.13588594920296im, 63.56042270417858 + 505.998493863502im, 10042.30941761443 - 1581.4830963977238im, 618.5920195074069 + 3261.4905413860374im, 181560.93267196615 - 40348.758197975374im, 718089.2221195609 - 2.8132197285842993e6im, 51641.289513545984 + 11476.379748219864im, 26887.45194553088 - 141762.5448819782im, 7452.351530173316 + 1173.611810978097im, 2754.6392562344004 - 21929.428348648176im, 1731.3223262511112 + 162.73546569194468im, 312.81692576604024 - 5000.184651026186im, 368.47549504118194 + 11.514843037089863im, -7.079292515059007e-5 + 2.2111192865647463e-12im, -368.47549504118405 + 11.514843037092259im, 312.8169257660317 + 5000.184651026195im, -1731.3223262511065 + 162.73546569194122im, 2754.639256234384 + 21929.42834864817im, -7452.351530173314 + 1173.6118109780987im, 26887.451945530865 + 141762.54488197807im, -51641.289513545955 + 11476.379748219959im, 718089.2221195622 + 2.8132197285843e6im, 4.9350439260886826e7 + 1.425285334817202e7im, -235152.8705069356 + 921245.6104842015im, 2.278257352447701e6 + 506303.05219003034im, -23401.839587336897 + 123384.76518192393im, 327624.2798307722 + 51594.926357493634im, -3473.2229055981784 + 27649.981335467077im, 75934.86336824033 + 7137.484205602112im, -468.0559176802639 + 7481.581644401449im, 16142.1327100284 + 504.44027676650336im, 0.0005315368401723479 - 7.816573135164471e-11im, -16142.132710028762 + 504.4402767665534im, -468.05591768017484 - 7481.5816444013535im, -75934.86336823982 + 7137.484205602086im, -3473.222905598293 - 27649.9813354672im, -327624.27983077324 + 51594.9263574938im, -23401.839587337225 - 123384.76518192382im, -2.278257352447706e6 + 506303.05219002994im, -235152.87050693555 - 921245.6104842013im, -4.9350439260886714e7 + 1.4252853348172052e7im, -3.1217011863290435e8 + 9.665487945412056e8im, -1.828784560942146e7 - 5.281697043201353e6im, -1.0494734999852685e7 + 4.111466184157924e7im, -2.2767155766733713e6 - 505961.02011782397im, -1.0401394545570737e6 + 5.484076122765654e6im, -483164.7598966196 - 76089.87258546877im, -153920.6231374564 + 1.225348304316515e6im, -136194.44621148796 - 12801.588981770154im, -20705.843306447787 + 330970.4943199601im, -31534.328870454327 - 985.4374304667521im, 0.023214229450056516 - 1.2313693041257584e-9im, 31534.328870454723 - 985.4374304655145im, -20705.843306447794 - 330970.49431995687im, 136194.44621148903 - 12801.588981771383im, -153920.6231374591 - 1.225348304316512e6im, 483164.75989662367 - 76089.87258547063im, -1.0401394545570685e6 - 5.484076122765655e6im, 2.276715576673382e6 - 505961.0201178255im, -1.049473499985263e7 - 4.1114661841579266e7im, 1.8287845609421458e7 - 5.281697043201307e6im, -3.1217011863290596e8 - 9.665487945412072e8im]
translated_weights_2 = ComplexF64[0.022557866738802963 + 2.4831153224885666e-17im, -0.0010999068146379416 + 0.035197018217537734im, 0.5632133972079553 - 5.7462715141731735e-18im, 0.0010999068146378276 + 0.03519701821753768im, -0.12192054149901801 - 0.007627482464476292im, -0.03658410774045798 + 1.1706914459755293im, -0.07327415268210201 - 7.632783294297951e-17im, 0.03658410774045806 + 1.1706914459755298im, -0.12192054149901586 + 0.007627482464475654im, 0.06246071690483199 - 0.664512084903771im, -4.558149179038614 - 0.2851628041995418im, 0.008929416539995159 - 0.2857413318708389im, -2.7378551320012536 + 1.0321604682062002e-16im, -0.008929416539994425 - 0.2857413318708409im, -4.558149179038619 + 0.2851628041995418im, -0.06246071690482913 - 0.6645120849037639im, 4.962201830313995 + 0.6233211131753488im, 2.4886830358985184 - 26.47679949521797im, 1.6623701261935722 + 0.10399969272160967im, 0.3553701771434546 - 11.371845553108189im, 1.1893845573228352 + 9.534202854294405e-16im, -0.35537017714345803 - 11.371845553108189im, 1.6623701261935249 - 0.10399969272160284im, -2.48868303589852 - 26.476799495217968im, 4.96220183031366 - 0.6233211131752985im, -7.422072277280592 + 47.12966093305094im, 205.77266887875032 + 25.84789340393594im, -1.2162814707267655 + 12.939873242642001im, 68.81495355946062 + 4.3051389382744265im, -0.22540022402630375 + 7.2128071354176795im, 49.2067017144702 - 3.858648426821598e-15im, 0.22540022402628707 + 7.212807135417785im, 68.81495355946069 - 4.305138938274438im, 1.2162814707267222 + 12.939873242642209im, 205.7726688787507 - 25.84789340393597im, 7.422072277279944 + 47.12966093305197im, -543.5818146763683 - 103.09862070280342im, -316.2966415745023 + 2008.4618956011434im, -126.49963360498778 - 15.890100622625344im, -51.7119677007366 + 550.1573811548325im, -57.78842380499931 - 3.615307066053623im, -9.572025903656042 + 306.30481411640716im, -45.021388742540566 - 9.894689912250468e-14im, 9.57202590365622 + 306.30481411640716im, -57.788423804997876 + 3.6153070660533655im, 51.711967700736906 + 550.1573811548327im, -126.49963360498325 + 15.890100622624553im, 316.2966415745028 + 2008.4618956011436im, -543.5818146763063 + 103.09862070279989im, 1639.4812608410466 - 7377.3288051139625im, -23627.091177676462 - 4481.242625027837im, 234.722212236491 - 1490.470572554713im, -5482.357140808447 - 688.6599480620306im, 54.24513757183242 - 577.107524355929im, -2500.0923356647054 - 156.40852942261424im, 11.514862089546666 - 368.4755410615434im, -1946.611950039368 + 3.4720946753027775e-13im, -11.514862089546765 - 368.47554106154064im, -2500.092335664704 + 156.40852942261537im, -54.24513757183105 - 577.1075243559293im, -5482.357140808439 + 688.6599480620329im, -234.7222122364892 - 1490.470572554788im, -23627.091177676422 + 4481.242625027844im, -1639.4812608408586 - 7377.328805114825im, 115155.75754686331 + 29394.055484418044im, 72329.02721255101 - 325465.3479689702im, 20564.13527830091 + 3900.301782375922im, 10318.988878165046 - 65524.857602977296im, 6912.497400703184 + 868.3051033544808im, 2379.16274401599 - 25311.621399895368im, 3740.791771008412 + 234.0280762331852im, 504.4417384133444 - 16142.132745070829im, 3065.742918132301 + 6.660684701642681e-12im, -504.44173841335146 - 16142.13274507083im, 3740.7917710084093 - 234.02807623317588im, -2379.1627440159996 - 25311.62139989536im, 6912.4974007031915 - 868.3051033544491im, -10318.988878165079 - 65524.85760297731im, 20564.135278300637 - 3900.3017823758046im, -72329.02721255126 - 325465.3479689702im, 115155.75754686647 - 29394.0554844163im, -586853.2759416987 + 2.0319848080060368e6im, 5.139333148731881e6 + 1.3118425416785565e6im, -72279.9796214294 + 325245.3280398346im, 914012.7414501152 + 173356.6835131206im, -15217.952718960956 + 96633.01000986125im, 306337.08494481584 + 38480.189379096584im, -4267.1957344985085 + 45398.171447756125im, 165485.24801472007 + 10352.941811749331im, -985.4488309414862 + 31534.343100442544im, 135542.27846902361 - 6.017126961741644e-11im, 985.4488309413989 + 31534.34310044216im, 165485.24801471998 - 10352.94181174938im, 4267.195734498377 + 45398.1714477554im, 306337.084944816 - 38480.18937909672im, 15217.95271896 + 96633.0100098572im, 914012.7414501152 - 173356.6835131211im, 72279.97962142785 + 325245.3280398342im, 5.139333148731872e6 - 1.3118425416785597e6im, 586853.2759416888 + 2.031984808006083e6im, 2.7653705899321645e8 + 4.5067905755250506e7im, 1.0683590800228126e8 - 1.3721562029355032e9im, 3.9718703254133284e7 + 5.158722488391682e6im, 1.309545616663897e7 - 2.1697654627611038e8im, 1.0495979738540491e7 + 1.0194107941874756e6im, 2.747217695104863e6 - 6.3886521763624e7im, 4.33472580581608e6 + 280081.43239465624im, 768483.6194741109 - 2.983528351733672e7im, 2.6054625929765166e6 + 84068.16161097093im, 177257.0189651879 - 2.0662628545654576e7im, 2.205927340671959e6 + 1.4015899384519886e-9im, -177257.0189651868 - 2.0662628545654576e7im, 2.6054625929765645e6 - 84068.16161096777im, -768483.6194741081 - 2.983528351733677e7im, 4.334725805816358e6 - 280081.4323946521im, -2.7472176951048533e6 - 6.388652176362407e7im, 1.0495979738541348e7 - 1.0194107941874722e6im, -1.3095456166638963e7 - 2.169765462761106e8im, 3.971870325413083e7 - 5.158722488391339e6im, -1.0683590800228147e8 - 1.372156202935504e9im, 2.7653705899318326e8 - 4.5067905755244024e7im]

expansion_order = 10

# create branches
center = SVector{3}([0.04, 0.04, -0.019999999999999997])
box = SVector{3}(0.0,0.0,0.0)

branch = Branch(1:1, 0, 1:0, 0, 1, center, center, 0.0, 0.0, box, box)
multipole_expansion = initialize_expansion(expansion_order)
translated_center = SVector{3}([0.96, 0.03, -0.02])
translated_branch = Branch(1:1, 0, 1:0, 0, 1, translated_center, translated_center, 0.0, 0.0, box, box)
translated_expansion = initialize_expansion(expansion_order)

# set source expansion
vector_to_expansion!(multipole_expansion, weights_1, 1, expansion_order)
vector_to_expansion!(multipole_expansion, weights_2, 2, expansion_order)

# preallocate containers
Hs_π2 = [1.0]
FastMultipole.update_Hs_π2!(Hs_π2, expansion_order)
Ts = zeros(FastMultipole.length_Ts(expansion_order))
eimϕs = zeros(2, expansion_order+2)
weights_tmp_1 = initialize_expansion(expansion_order, eltype(Ts))
weights_tmp_2 = initialize_expansion(expansion_order, eltype(Ts))
weights_tmp_3 = initialize_expansion(expansion_order, eltype(Ts))

# normalization
ζs_mag = zeros(FastMultipole.length_ζs(expansion_order))
FastMultipole.update_ζs_mag!(ζs_mag, 0, expansion_order)
ηs_mag = zeros(FastMultipole.length_ηs(expansion_order))
FastMultipole.update_ηs_mag!(ηs_mag, 0, expansion_order)

lamb_helmholtz = Val(true)

# translate expansion
FastMultipole.multipole_to_local!(translated_expansion, translated_branch, multipole_expansion, branch, weights_tmp_1, weights_tmp_2, weights_tmp_3, Ts, eimϕs, ζs_mag, ηs_mag, Hs_π2, FastMultipole.M̃, FastMultipole.L̃, expansion_order, lamb_helmholtz)

# apply Lamb-Helmholtz
i, i_compressed = 1, 1
for n in 0:7
    for m in -n:n
        if m >= 0
            @test isapprox(translated_expansion[1,1,i_compressed], real(translated_weights_1[i]); rtol=1e-12, atol=1e-12)
            @test isapprox(translated_expansion[2,1,i_compressed], imag(translated_weights_1[i]); rtol=1e-12, atol=1e-12)
            @test isapprox(translated_expansion[1,2,i_compressed], real(translated_weights_2[i]); rtol=1e-12, atol=1e-12)
            @test isapprox(translated_expansion[2,2,i_compressed], imag(translated_weights_2[i]); rtol=1e-12, atol=1e-12)
            i_compressed += 1
        end
        i += 1
    end
end

end

@testset "Lamb-Helmholtz transform: local-to-local" begin

weights_1 = ComplexF64[0.0219171658794426 + 1.733358189231408e-18im, 1.0827776033663565 + 0.03383680010508041im, -8.132627323977414e-13 - 3.3306690738754696e-16im, -1.0827776033663568 + 0.033836800105080424im, -0.21118210923806 + 3.3756140271768924im, -0.03519701820188462 - 0.0010999068254175515im, 1.4065609788005418e-11 + 1.1796119636642288e-16im, 0.0351970182018851 - 0.0010999068254176694im, -0.21118210923806002 - 3.375614027176893im, -17.522234276726905 - 1.6469999227153034im, 0.01525496521011808 - 0.2438410825584145im, -1.1706914459176119 - 0.03658410754233507im, 2.826502530292596e-11 - 2.5587171270657905e-17im, 1.1706914459176079 - 0.036584107542335im, 0.015254965210118413 + 0.24384108255841805im, 17.522234276726916 - 1.6469999227153045im, 15.979530485686961 - 127.21155526517697im, 1.9935362427580594 + 0.18738215894239674im, 0.5703256039635055 - 9.116298356283352im, 0.2857413305289757 + 0.008929416984706605im, -1.5747587347894696e-9 + 7.843118515760139e-16im, -0.2857413305289844 + 0.008929416984706662im, 0.5703256039635106 + 9.116298356283352im, -1.9935362427580765 + 0.18738215894240087im, 15.979530485686952 + 127.21155526517701im, 1186.2535098244596 + 186.81359139051258im, -2.4932847087415806 + 19.848806977671405im, 79.43039843091928 + 7.466048989223858im, -0.20799940096539113 + 3.3247402088054074im, 11.371845548337694 + 0.35537015151988327im, 5.469416012487179e-10 - 3.088578926033897e-14im, -11.37184554833758 + 0.35537015151989093im, -0.20799940096539776 - 3.324740208805434im, -79.4303984309192 + 7.466048989223869im, -2.4932847087416334 - 19.84880697767167im, -1186.253509824462 + 186.81359139051273im, -2561.7241179695957 + 13506.543046108265im, -235.6482941064074 - 37.11036983354065im, -103.39157011919704 + 823.0906737492265im, -38.81961842177087 - 3.6488449713663704im, -8.610277269692707 + 137.6299069494625im, -7.212806931846006 - 0.22540021672708935im, 2.8255669613408456e-7 + 4.355531506208127e-14im, 7.212806931846177 - 0.22540021672712712im, -8.61027726969274 - 137.62990694946262im, 38.81961842177114 - 3.648844971366439im, -103.39157011919744 - 823.0906737492269im, 235.64829410640746 - 37.11036983354106im, -2561.724117969593 - 13506.543046108272im, -181560.93267196638 - 40348.75819797531im, 618.59201950741 - 3261.490541386032im, -10042.309417614455 - 1581.483096397723im, 63.560422704179565 - 505.99849386350286im, -1650.4721375737067 - 155.1358859492022im, 7.230614943276541 - 115.57684010637581im, -306.3048136148472 - 9.572020687951166im, -9.993593403748828e-7 + 5.872456875297008e-13im, 306.3048136148513 - 9.572020687950884im, 7.230614943276854 + 115.57684010637907im, 1650.4721375737195 - 155.13588594920296im, 63.56042270417858 + 505.998493863502im, 10042.30941761443 - 1581.4830963977238im, 618.5920195074069 + 3261.4905413860374im, 181560.93267196615 - 40348.758197975374im, 718089.2221195609 - 2.8132197285842993e6im, 51641.289513545984 + 11476.379748219864im, 26887.45194553088 - 141762.5448819782im, 7452.351530173316 + 1173.611810978097im, 2754.6392562344004 - 21929.428348648176im, 1731.3223262511112 + 162.73546569194468im, 312.81692576604024 - 5000.184651026186im, 368.47549504118194 + 11.514843037089863im, -7.079292515059007e-5 + 2.2111192865647463e-12im, -368.47549504118405 + 11.514843037092259im, 312.8169257660317 + 5000.184651026195im, -1731.3223262511065 + 162.73546569194122im, 2754.639256234384 + 21929.42834864817im, -7452.351530173314 + 1173.6118109780987im, 26887.451945530865 + 141762.54488197807im, -51641.289513545955 + 11476.379748219959im, 718089.2221195622 + 2.8132197285843e6im, 4.9350439260886826e7 + 1.425285334817202e7im, -235152.8705069356 + 921245.6104842015im, 2.278257352447701e6 + 506303.05219003034im, -23401.839587336897 + 123384.76518192393im, 327624.2798307722 + 51594.926357493634im, -3473.2229055981784 + 27649.981335467077im, 75934.86336824033 + 7137.484205602112im, -468.0559176802639 + 7481.581644401449im, 16142.1327100284 + 504.44027676650336im, 0.0005315368401723479 - 7.816573135164471e-11im, -16142.132710028762 + 504.4402767665534im, -468.05591768017484 - 7481.5816444013535im, -75934.86336823982 + 7137.484205602086im, -3473.222905598293 - 27649.9813354672im, -327624.27983077324 + 51594.9263574938im, -23401.839587337225 - 123384.76518192382im, -2.278257352447706e6 + 506303.05219002994im, -235152.87050693555 - 921245.6104842013im, -4.9350439260886714e7 + 1.4252853348172052e7im, -3.1217011863290435e8 + 9.665487945412056e8im, -1.828784560942146e7 - 5.281697043201353e6im, -1.0494734999852685e7 + 4.111466184157924e7im, -2.2767155766733713e6 - 505961.02011782397im, -1.0401394545570737e6 + 5.484076122765654e6im, -483164.7598966196 - 76089.87258546877im, -153920.6231374564 + 1.225348304316515e6im, -136194.44621148796 - 12801.588981770154im, -20705.843306447787 + 330970.4943199601im, -31534.328870454327 - 985.4374304667521im, 0.023214229450056516 - 1.2313693041257584e-9im, 31534.328870454723 - 985.4374304655145im, -20705.843306447794 - 330970.49431995687im, 136194.44621148903 - 12801.588981771383im, -153920.6231374591 - 1.225348304316512e6im, 483164.75989662367 - 76089.87258547063im, -1.0401394545570685e6 - 5.484076122765655e6im, 2.276715576673382e6 - 505961.0201178255im, -1.049473499985263e7 - 4.1114661841579266e7im, 1.8287845609421458e7 - 5.281697043201307e6im, -3.1217011863290596e8 - 9.665487945412072e8im]
weights_2 = ComplexF64[0.022557866738802963 + 2.4831153224885666e-17im, -0.0010999068146379416 + 0.035197018217537734im, 0.5632133972079553 - 5.7462715141731735e-18im, 0.0010999068146378276 + 0.03519701821753768im, -0.12192054149901801 - 0.007627482464476292im, -0.03658410774045798 + 1.1706914459755293im, -0.07327415268210201 - 7.632783294297951e-17im, 0.03658410774045806 + 1.1706914459755298im, -0.12192054149901586 + 0.007627482464475654im, 0.06246071690483199 - 0.664512084903771im, -4.558149179038614 - 0.2851628041995418im, 0.008929416539995159 - 0.2857413318708389im, -2.7378551320012536 + 1.0321604682062002e-16im, -0.008929416539994425 - 0.2857413318708409im, -4.558149179038619 + 0.2851628041995418im, -0.06246071690482913 - 0.6645120849037639im, 4.962201830313995 + 0.6233211131753488im, 2.4886830358985184 - 26.47679949521797im, 1.6623701261935722 + 0.10399969272160967im, 0.3553701771434546 - 11.371845553108189im, 1.1893845573228352 + 9.534202854294405e-16im, -0.35537017714345803 - 11.371845553108189im, 1.6623701261935249 - 0.10399969272160284im, -2.48868303589852 - 26.476799495217968im, 4.96220183031366 - 0.6233211131752985im, -7.422072277280592 + 47.12966093305094im, 205.77266887875032 + 25.84789340393594im, -1.2162814707267655 + 12.939873242642001im, 68.81495355946062 + 4.3051389382744265im, -0.22540022402630375 + 7.2128071354176795im, 49.2067017144702 - 3.858648426821598e-15im, 0.22540022402628707 + 7.212807135417785im, 68.81495355946069 - 4.305138938274438im, 1.2162814707267222 + 12.939873242642209im, 205.7726688787507 - 25.84789340393597im, 7.422072277279944 + 47.12966093305197im, -543.5818146763683 - 103.09862070280342im, -316.2966415745023 + 2008.4618956011434im, -126.49963360498778 - 15.890100622625344im, -51.7119677007366 + 550.1573811548325im, -57.78842380499931 - 3.615307066053623im, -9.572025903656042 + 306.30481411640716im, -45.021388742540566 - 9.894689912250468e-14im, 9.57202590365622 + 306.30481411640716im, -57.788423804997876 + 3.6153070660533655im, 51.711967700736906 + 550.1573811548327im, -126.49963360498325 + 15.890100622624553im, 316.2966415745028 + 2008.4618956011436im, -543.5818146763063 + 103.09862070279989im, 1639.4812608410466 - 7377.3288051139625im, -23627.091177676462 - 4481.242625027837im, 234.722212236491 - 1490.470572554713im, -5482.357140808447 - 688.6599480620306im, 54.24513757183242 - 577.107524355929im, -2500.0923356647054 - 156.40852942261424im, 11.514862089546666 - 368.4755410615434im, -1946.611950039368 + 3.4720946753027775e-13im, -11.514862089546765 - 368.47554106154064im, -2500.092335664704 + 156.40852942261537im, -54.24513757183105 - 577.1075243559293im, -5482.357140808439 + 688.6599480620329im, -234.7222122364892 - 1490.470572554788im, -23627.091177676422 + 4481.242625027844im, -1639.4812608408586 - 7377.328805114825im, 115155.75754686331 + 29394.055484418044im, 72329.02721255101 - 325465.3479689702im, 20564.13527830091 + 3900.301782375922im, 10318.988878165046 - 65524.857602977296im, 6912.497400703184 + 868.3051033544808im, 2379.16274401599 - 25311.621399895368im, 3740.791771008412 + 234.0280762331852im, 504.4417384133444 - 16142.132745070829im, 3065.742918132301 + 6.660684701642681e-12im, -504.44173841335146 - 16142.13274507083im, 3740.7917710084093 - 234.02807623317588im, -2379.1627440159996 - 25311.62139989536im, 6912.4974007031915 - 868.3051033544491im, -10318.988878165079 - 65524.85760297731im, 20564.135278300637 - 3900.3017823758046im, -72329.02721255126 - 325465.3479689702im, 115155.75754686647 - 29394.0554844163im, -586853.2759416987 + 2.0319848080060368e6im, 5.139333148731881e6 + 1.3118425416785565e6im, -72279.9796214294 + 325245.3280398346im, 914012.7414501152 + 173356.6835131206im, -15217.952718960956 + 96633.01000986125im, 306337.08494481584 + 38480.189379096584im, -4267.1957344985085 + 45398.171447756125im, 165485.24801472007 + 10352.941811749331im, -985.4488309414862 + 31534.343100442544im, 135542.27846902361 - 6.017126961741644e-11im, 985.4488309413989 + 31534.34310044216im, 165485.24801471998 - 10352.94181174938im, 4267.195734498377 + 45398.1714477554im, 306337.084944816 - 38480.18937909672im, 15217.95271896 + 96633.0100098572im, 914012.7414501152 - 173356.6835131211im, 72279.97962142785 + 325245.3280398342im, 5.139333148731872e6 - 1.3118425416785597e6im, 586853.2759416888 + 2.031984808006083e6im, 2.7653705899321645e8 + 4.5067905755250506e7im, 1.0683590800228126e8 - 1.3721562029355032e9im, 3.9718703254133284e7 + 5.158722488391682e6im, 1.309545616663897e7 - 2.1697654627611038e8im, 1.0495979738540491e7 + 1.0194107941874756e6im, 2.747217695104863e6 - 6.3886521763624e7im, 4.33472580581608e6 + 280081.43239465624im, 768483.6194741109 - 2.983528351733672e7im, 2.6054625929765166e6 + 84068.16161097093im, 177257.0189651879 - 2.0662628545654576e7im, 2.205927340671959e6 + 1.4015899384519886e-9im, -177257.0189651868 - 2.0662628545654576e7im, 2.6054625929765645e6 - 84068.16161096777im, -768483.6194741081 - 2.983528351733677e7im, 4.334725805816358e6 - 280081.4323946521im, -2.7472176951048533e6 - 6.388652176362407e7im, 1.0495979738541348e7 - 1.0194107941874722e6im, -1.3095456166638963e7 - 2.169765462761106e8im, 3.971870325413083e7 - 5.158722488391339e6im, -1.0683590800228147e8 - 1.372156202935504e9im, 2.7653705899318326e8 - 4.5067905755244024e7im]
translated_weights_1 = ComplexF64[0.00023680186164916613 + 1.3081898548489648e-17im, 1.0409076545682514 + 0.010621506679265064im, -1.2488066136739917e-12 - 3.608224830031759e-16im, -1.040907654568252 + 0.01062150667926523im, -0.06501609334135017 + 3.185456859330558im, 0.016254023339788204 + 0.00016585742316099772im, -6.757372439381015e-12 + 1.734723475976807e-17im, -0.01625402333978787 + 0.00016585742316099772im, -0.06501609334134999 - 3.1854568593305603im, -16.245563016179425 - 0.4974512587061638im, -0.0022560926821043117 + 0.11053706605250502im, -1.083037533733817 - 0.01105141200624804im, 9.056560529296931e-9 + 2.7755575615628914e-16im, 1.0830375337338145 - 0.011051412006248817im, -0.002256092682097144 - 0.11053706605249625im, 16.245563016179457 - 0.4974512587061676im, 4.7363263202158485 - 115.9793309667591im, -0.887871102583061 - 0.027187208588374995im, 0.1690825056547775 - 8.28423864240519im, -0.126874211866209 - 0.0012940209820723192im, -2.055008378409884e-6 + 1.6653345369377348e-15im, 0.12687421186619963 - 0.001294020982061772im, 0.1690825056547478 + 8.284238642405189im, 0.8878711025830857 - 0.02718720858842616im, 4.736326320215868 + 115.97933096675914im, 1064.4474161158541 + 54.35320323297239im, 0.3545209870649701 - 8.69311707300109im, 70.96309742058767 + 2.172908145224123im, 0.02982841009608124 - 1.4493951679864292im, 10.137588227292428 + 0.1035143917044895im, 0.0002967277228882459 - 1.199040866595169e-14im, -10.137588227292355 + 0.1035143917043917im, 0.02982841009603865 + 1.4493951679863386im, -70.96309742058747 + 2.1729081452241346im, 0.35452098706502966 + 8.693117073001051im, -1064.447416115858 + 54.35320323297307im, -731.3603883916059 + 11939.690513192216im, 101.73659124920856 + 5.3129566471208545im, -29.55268949420206 + 723.6212697674418im, 16.658050179781252 + 0.49659911676734125im, -2.4872647243445067 + 120.59865215002304im, 3.0862303840240757 + 0.004862185839683425im, -0.026056549928586747 + 1.3944401189291966e-13im, -3.086230384023974 + 0.004862185839936473im, -2.4872647243439303 - 120.59865215002239im, -16.65805017978218 + 0.49659911676689816im, -29.55268949420281 - 723.6212697674422im, -101.73659124920778 + 5.312956647120927im, -731.3603883916068 - 11939.690513192223im, -158299.5569542469 - 11464.508125694661im, -85.37553465285204 + 1350.1955635420695im, -8701.328783606186 - 449.6992534746018im, -6.732823145041436 + 208.90741504534859im, -1424.8031918306756 - 40.340594801910335im, -0.013214978863713256 + 47.618464638475814im, -263.9714499925566 + 1.0774040837859307im, 0.7155739370820107 + 7.176481631177012e-13im, 263.97144999256466 + 1.0774040837825538im, -0.013214978867239324 - 47.618464638476im, 1424.8031918306933 - 40.34059480189978im, -6.732823145051782 - 208.90741504533867im, 8701.328783606154 - 449.6992534746023im, -85.37553465283781 - 1350.1955635420422im, 158299.55695424663 - 11464.508125694689im, 189811.35318440266 - 2.395855121567277e6im, -21858.262225646067 + 2408.3974344917906im, 6482.043254847229 - 118864.8051154762im, -3007.413937586192 - 348.41515097374054im, 757.9281512215042 - 18168.5884005239im, -676.7548790419379 - 340.9359662860532im, 194.45961505351738 - 4111.606560817593im, -141.7523590172962 - 281.6546801845422im, 119.01111430702707 - 1.4381384971784428e-11im, 141.7523590172858 - 281.6546801845483im, 194.45961505358355 + 4111.606560817573im, 676.7548790419166 - 340.9359662860261im, 757.9281512214857 + 18168.58840052385im, 3007.413937586143 - 348.41515097382216im, 6482.043254847213 + 118864.8051154759im, 21858.26222564647 + 2408.3974344934104im, 189811.35318440758 + 2.3958551215672838e6im, 4.356180028024465e7 + 2.2300558858107817e6im, 487765.5431401305 - 1.0837364236368868e6im, 2.065124155668599e6 + 168023.78540548135im, 8120.554480091791 - 147709.172133746im, 303007.42585947976 + 35750.70519851885im, -15872.886338445158 - 33499.1939793431im, 71183.12568219526 + 13675.513490594505im, -14553.53158786875 - 9127.673749504462im, 15234.768895959287 + 8558.752579739337im, -13546.117053462056 - 1.2170175978098996e-10im, -15234.768895960213 + 8558.752579740001im, -14553.531587869104 + 9127.67374950472im, -71183.12568219512 + 13675.513490594241im, -15872.886338444852 + 33499.19397934451im, -303007.4258594819 + 35750.70519851777im, 8120.554480095656 + 147709.17213374234im, -2.0651241556686102e6 + 168023.78540548473im, 487765.5431401521 + 1.0837364236369038e6im, -4.3561800280244574e7 + 2.230055885810701e6im, -2.855116755615794e8 + 9.878325249901634e8im, -5.595726502454949e7 - 7.188021959964938e6im, -3.7430818162854235e6 + 4.177206841758276e7im, -6.925304745230927e6 - 485231.65033571166im, 876726.8146055979 + 5.545763958373686e6im, -1.4633018502023665e6 + 1098.4802529344738im, 656177.9893737262 + 1.2349485101509537e6im, -411293.3870631945 + 45363.836718181396im, 470453.16107797856 + 332881.9463546396im, -95094.86537251768 + 46953.7690513129im, 416797.7345066352 + 1.9317667465656996e-9im, 95094.86537252282 + 46953.76905131442im, 470453.1610779829 - 332881.946354641im, 411293.3870632034 + 45363.83671818618im, 656177.9893737352 - 1.23494851015095e6im, 1.4633018502023895e6 + 1098.4802529213484im, 876726.8146055802 - 5.5457639583736975e6im, 6.925304745230861e6 - 485231.6503356716im, -3.743081816284881e6 - 4.177206841758293e7im, 5.595726502455008e7 - 7.188021959965251e6im, -2.8551167556158495e8 - 9.878325249901664e8im]
translated_weights_2 = ComplexF64[-0.010621506677279123 + 2.145022000511784e-17im, 0.00016585733895184418 - 0.016254023338559534im, 0.5309094765008691 - 3.469446951953614e-18im, -0.00016585733895191357 - 0.016254023338559825im, 0.05526854411927064 + 0.0011280561426428512im, -0.011051399330351201 + 1.0830375397450214im, 0.03316573020246058 + 2.7755575615628914e-16im, 0.01105139933035132 + 1.0830375397450227im, 0.0552685441192724 - 0.0011280561426441071im, -0.009063819683096401 + 0.29595410810994616im, -4.142120051739837 - 0.08454341651598282im, -0.0012948177573108358 + 0.12687290152055086im, -2.4852718724950633 + 5.551115123125783e-17im, 0.0012948177573105513 + 0.12687290152054792im, -4.142120051739838 + 0.08454341651598263im, 0.009063819683081231 + 0.2959541081099637im, -2.1733172756007773 - 0.08786232630928732im, 0.7242351184857252 - 23.6539832898224im, -0.724730520259632 - 0.01461851375699616im, 0.10342598507970285 - 10.13740282257064im, -0.5177251804368922 + 8.298917109073045e-15im, -0.10342598507970568 - 10.137402822570671im, -0.7247305202596966 + 0.014618513756996965im, -0.7242351184857165 - 23.653983289822392im, -2.1733172756010326 + 0.08786232630942159im, 1.1549792141118496 - 20.484972411709048im, 180.9476673206237 + 7.329554679692372im, 0.19555306731322483 - 5.586183166177135im, 60.315978031847536 + 1.2185844307540163im, 0.036829511816060534 - 3.104198643795558im, 43.08216458813606 - 2.5091040356528538e-14im, -0.03682951181603328 - 3.1041986437954128im, 60.31597803184762 - 1.2185844307539622im, -0.19555306731318467 - 5.586183166176801im, 180.94766732062354 - 7.3295546796923645im, -1.154979214112771 - 20.484972411707076im, 197.3029873135067 + 27.70239912026842im, -101.72926041518652 + 1745.7046849333872im, 46.38285045482169 + 3.692920462336433im, -17.473500535773677 + 476.63505311510534im, 21.2901172842574 + 0.7611201248613372im, -3.3125857311796763 + 265.0222849834057im, 16.609374194872345 - 3.9168668308775523e-13im, 3.3125857311795546 + 265.02228498340594im, 21.290117284258443 - 0.761120124861475im, 17.473500535774477 + 476.6350531151041im, 46.382850454827675 - 3.692920462339515im, 101.72926041518917 + 1745.7046849333947im, 197.3029873135763 - 27.70239912026338im, 5477.665764360017 + 3530.0419217605463im, -18043.92862085789 - 795.0280022752265im, 773.0973609572721 + 636.2644583062488im, -4056.3712071802665 - 47.7099522336201im, 176.94254135690554 + 227.2650147553041im, -1812.450300961392 - 0.6386476416570761im, 37.37702299551503 + 139.15279838348718im, -1401.2945407399409 + 5.796252366963017e-12im, -37.3770229955195 + 139.15279838348857im, -1812.4503009613911 + 0.6386476416448801im, -176.94254135689715 + 227.26501475530347im, -4056.371207180261 + 47.70995223363866im, -773.0973609572748 + 636.264458306182im, -18043.92862085779 + 795.0280022751631im, -5477.665764359736 + 3530.0419217597773im, -607419.8459561125 - 539102.0673074684im, -131629.78242720454 - 377611.9459792426im, -109341.8582419474 - 71345.80157707544im, -17577.22725199827 - 82879.49269532993im, -36955.49482668769 - 15853.506117443101im, -3866.7293021360542 - 33798.255537002944im, -20062.497283297565 - 4268.052614370024im, -800.0614712796639 - 22126.08269101419im, -16459.219785019308 - 5.4711790653527714e-12im, 800.061471279664 - 22126.082691014188im, -20062.497283297544 + 4268.052614370222im, 3866.729302135999 - 33798.25553700302im, -36955.494826687755 + 15853.506117443032im, 17577.227251997938 - 82879.49269533055im, -109341.85824194703 + 71345.8015770757im, 131629.78242720402 - 377611.9459792432im, -607419.845956111 + 539102.0673074706im, -7.269933063827064e6 + 5.035295187366288e7im, 2.027793121248121e7 + 1.5167825928673118e7im, -893839.4579003127 + 7.9923004394347e6im, 3.543308535328518e6 + 1.9979758094214487e6im, -187944.34440977525 + 2.359893366217652e6im, 1.1724649166115068e6 + 442473.83727960434im, -52654.69605243987 + 1.1041484539279675e6im, 628478.5225338078 + 118881.044189923im, -12154.568009866187 + 765401.6245994567im, 513424.8498140151 - 8.731149137020111e-11im, 12154.568009864159 + 765401.6245994581im, 628478.5225338053 - 118881.04418992641im, 52654.696052440864 + 1.1041484539279768e6im, 1.1724649166115043e6 - 442473.83727959916im, 187944.3444097951 + 2.3598933662176803e6im, 3.54330853532846e6 - 1.9979758094214888e6im, 893839.4579003663 + 7.99230043943465e6im, 2.0277931212481145e7 - 1.5167825928673077e7im, 7.269933063826716e6 + 5.0352951873662695e7im, 2.765370589932581e8 + 4.506790575526045e7im, 1.0683590800228378e8 - 1.3721562029355116e9im, 3.971870325413288e7 + 5.158722488393925e6im, 1.3095456166637337e7 - 2.1697654627611145e8im, 1.0495979738540534e7 + 1.0194107941872039e6im, 2.7472176951053445e6 - 6.3886521763623826e7im, 4.334725805816189e6 + 280081.4323946103im, 768483.6194738873 - 2.9835283517336797e7im, 2.6054625929764365e6 + 84068.16161101883im, 177257.01896532564 - 2.0662628545654573e7im, 2.2059273406719915e6 - 2.4600012693554163e-8im, -177257.0189652858 - 2.066262854565452e7im, 2.605462592976463e6 - 84068.16161100825im, -768483.6194739868 - 2.9835283517337006e7im, 4.334725805816522e6 - 280081.43239470385im, -2.7472176951050097e6 - 6.388652176362362e7im, 1.0495979738541352e7 - 1.0194107941872124e6im, -1.3095456166637823e7 - 2.1697654627611196e8im, 3.9718703254129834e7 - 5.158722488392249e6im, -1.0683590800228566e8 - 1.3721562029355078e9im, 2.765370589931896e8 - 4.506790575527716e7im]

expansion_order = 10

# create branches
center = SVector{3}([0.96, 0.03, -0.02])
box = SVector{3}(0.0,0.0,0.0)

branch = Branch(1:1, 0, 1:0, 0, 1, center, center, 0.0, 0.0, box, box)
local_expansion = initialize_expansion(expansion_order)
translated_center = SVector{3}([0.98, 0.01, 0.01])
translated_branch = Branch(1:1, 0, 1:0, 0, 1, translated_center, translated_center, 0.0, 0.0, box, box)
translated_expansion = initialize_expansion(expansion_order)

# set source expansion
vector_to_expansion!(local_expansion, weights_1, 1, expansion_order)
vector_to_expansion!(local_expansion, weights_2, 2, expansion_order)

# preallocate containers
Hs_π2 = [1.0]
FastMultipole.update_Hs_π2!(Hs_π2, expansion_order)
Ts = zeros(FastMultipole.length_Ts(expansion_order))
eimϕs = zeros(2, expansion_order+2)
weights_tmp_1 = initialize_expansion(expansion_order, eltype(Ts))
weights_tmp_2 = initialize_expansion(expansion_order, eltype(Ts))

# normalization
ηs_mag = zeros(FastMultipole.length_ηs(expansion_order))
FastMultipole.update_ηs_mag!(ηs_mag, 0, expansion_order)

lamb_helmholtz = Val(true)

# translate expansion
FastMultipole.local_to_local!(translated_expansion, translated_branch, local_expansion, branch, weights_tmp_1, weights_tmp_2, Ts, eimϕs, ηs_mag, Hs_π2, expansion_order, lamb_helmholtz)

i, i_compressed = 1, 1
for n in 0:7
    for m in -n:n
        if m >= 0
            @test isapprox(translated_expansion[1,1,i_compressed], real(translated_weights_1[i]); rtol=1e-12, atol=1e-11)
            @test isapprox(translated_expansion[2,1,i_compressed], imag(translated_weights_1[i]); rtol=1e-12, atol=1e-11)
            @test isapprox(translated_expansion[1,2,i_compressed], real(translated_weights_2[i]); rtol=1e-12, atol=1e-11)
            @test isapprox(translated_expansion[2,2,i_compressed], imag(translated_weights_2[i]); rtol=1e-12, atol=1e-11)
            i_compressed += 1
        end
        i += 1
    end
end

end

@testset "Lamb-Helmholtz: vorton" begin

# vorton test
expansion_order = 10
x_source = SVector{3}(0.0,0,0)
x_target = SVector{3}(1.0,0,0)
Γ = SVector{3}(0,0,1.0)
center = SVector{3}(0.01, 0.02, -0.03)
box = SVector{3}(0.0,0.0,0.0)

branch = Branch(1:1, 0, 1:0, 0, 1, center, center, 0.0, 0.0, box, box)
multipole_expansion = initialize_expansion(expansion_order)
local_branch = Branch(1:1, 0, 1:0, 0, 1, x_target + SVector{3}(-0.04, 0.03, -0.02), x_target + SVector{3}(-0.04, 0.03, -0.02), 0.0, 0.0, box, box)
local_expansion = initialize_expansion(expansion_order)
harmonics = FastMultipole.initialize_harmonics(expansion_order)

multipole_weights_1 = ComplexF64[0.0 + 0.0im, -0.0025 - 0.005im, 0.0 + 0.0im, 0.0025 - 0.005im, 3.333333333333335e-5 + 2.500000000000001e-5im, -4.9999999999999996e-5 - 9.999999999999999e-5im, 0.0 + 0.0im, 4.9999999999999996e-5 - 9.999999999999999e-5im, 3.333333333333335e-5 - 2.500000000000001e-5im, -1.7187500000000013e-7 - 3.125000000000006e-8im, 7.500000000000004e-7 + 5.625000000000003e-7im, -4.843749999999998e-7 - 9.687499999999996e-7im, 0.0 + 0.0im, 4.843749999999998e-7 - 9.687499999999996e-7im, 7.500000000000004e-7 - 5.625000000000003e-7im, 1.7187500000000013e-7 - 3.125000000000006e-8im, 5.000000000000007e-10 - 1.458333333333335e-10im, -4.125000000000003e-9 - 7.500000000000011e-10im, 8.16666666666667e-9 + 6.125000000000003e-9im, -2.6249999999999974e-9 - 5.2499999999999966e-9im, 0.0 + 0.0im, 2.6249999999999974e-9 - 5.2499999999999966e-9im, 8.16666666666667e-9 - 6.125000000000003e-9im, 4.125000000000003e-9 - 7.500000000000011e-10im, 5.000000000000007e-10 + 1.458333333333335e-10im, -8.897569444444466e-13 + 8.246527777777796e-13im, 1.2500000000000005e-11 - 3.6458333333333345e-12im, -4.798177083333337e-11 - 8.72395833333334e-12im, 5.4166666666666686e-11 + 4.062500000000001e-11im, -5.772569444444427e-12 - 1.1545138888888862e-11im, 0.0 + 0.0im, 5.772569444444427e-12 - 1.1545138888888862e-11im, 5.4166666666666686e-11 - 4.062500000000001e-11im, 4.798177083333337e-11 - 8.72395833333334e-12im, 1.2500000000000005e-11 + 3.6458333333333345e-12im, 8.897569444444466e-13 + 8.246527777777796e-13im, 8.184523809523819e-16 - 2.1763392857142933e-15im, -2.2879464285714336e-14 + 2.1205357142857183e-14im, 1.5178571428571467e-13 - 4.427083333333343e-14im, -3.4988839285714296e-13 - 6.36160714285715e-14im, 2.235863095238098e-13 + 1.676897321428574e-13im, 2.834821428571441e-14 + 5.669642857142871e-14im, 0.0 + 0.0im, -2.834821428571441e-14 + 5.669642857142871e-14im, 2.235863095238098e-13 - 1.676897321428574e-13im, 3.4988839285714296e-13 - 6.36160714285715e-14im, 1.5178571428571467e-13 + 4.427083333333343e-14im, 2.2879464285714336e-14 + 2.1205357142857183e-14im, 8.184523809523819e-16 + 2.1763392857142933e-15im, 3.933376736111114e-19 + 3.7706163194444516e-18im, 2.1484375000000026e-17 - 5.71289062500002e-17im, -2.8639051649305604e-16 + 2.6543511284722267e-16im, 1.1718750000000027e-15 - 3.417968750000007e-16im, -1.7254638671875033e-15 - 3.1372070312500076e-16im, 4.316406250000017e-16 + 3.2373046875000143e-16im, 3.2781304253472126e-16 + 6.556260850694421e-16im, 0.0 + 0.0im, -3.2781304253472126e-16 + 6.556260850694421e-16im, 4.316406250000017e-16 - 3.2373046875000143e-16im, 1.7254638671875033e-15 - 3.1372070312500076e-16im, 1.1718750000000027e-15 + 3.417968750000007e-16im, 2.8639051649305604e-16 + 2.6543511284722267e-16im, 2.1484375000000026e-17 + 5.71289062500002e-17im, -3.933376736111114e-19 + 3.7706163194444516e-18im, -2.8935185185185183e-21 - 4.538346009700186e-21im, 1.0489004629629646e-20 + 1.0054976851851883e-19im, 2.750909391534395e-19 - 7.3149181547619315e-19im, -2.298538773148151e-18 + 2.130353009259262e-18im, 6.322337962962972e-18 - 1.844015239197533e-18im, -5.621744791666671e-18 - 1.0221354166666681e-18im, -1.1800733024691392e-18 - 8.85054976851854e-19im, 1.5913835152116374e-18 + 3.1827670304232737e-18im, 0.0 + 0.0im, -1.5913835152116374e-18 + 3.1827670304232737e-18im, -1.1800733024691392e-18 + 8.85054976851854e-19im, 5.621744791666671e-18 - 1.0221354166666681e-18im, 6.322337962962972e-18 + 1.844015239197533e-18im, 2.298538773148151e-18 + 2.130353009259262e-18im, 2.750909391534395e-19 + 7.3149181547619315e-19im, -1.0489004629629646e-20 + 1.0054976851851883e-19im, -2.8935185185185183e-21 + 4.538346009700186e-21im, 5.808027963789718e-24 + 3.4780350942460546e-24im, -7.812499999999994e-23 - 1.2253534226190493e-22im, 1.3668484157986129e-22 + 1.3102891710069483e-21im, 2.2712053571428575e-21 - 6.039341517857155e-21im, -1.311199854290675e-20 + 1.2152584015376984e-20im, 2.445312500000003e-20 - 7.132161458333344e-21im, -8.998074001736076e-21 - 1.6360134548611065e-21im, -1.3312872023809537e-20 - 9.984654017857154e-21im, 4.541180323040666e-21 + 9.082360646081333e-21im, 0.0 + 0.0im, -4.541180323040666e-21 + 9.082360646081333e-21im, -1.3312872023809537e-20 + 9.984654017857154e-21im, 8.998074001736076e-21 - 1.6360134548611065e-21im, 2.445312500000003e-20 + 7.132161458333344e-21im, 1.311199854290675e-20 + 1.2152584015376984e-20im, 2.2712053571428575e-21 + 6.039341517857155e-21im, -1.3668484157986129e-22 + 1.3102891710069483e-21im, -7.812499999999994e-23 + 1.2253534226190493e-22im, -5.808027963789718e-24 + 3.4780350942460546e-24im, -7.6232782938512e-27 - 5.798193054052366e-28im, 1.5840076264880992e-25 + 9.485550257034661e-26im, -1.0324600168350196e-24 - 1.619364371643026e-24im, 1.1531945430871238e-24 + 1.105476148200761e-23im, 1.3465518043154768e-23 - 3.580603661475252e-23im, -5.548703412472947e-23 + 5.1427007237554135e-23im, 6.463350018037516e-23 - 1.8851437552609444e-23im, 1.9525437127976443e-23 + 3.5500794778138974e-24im, -5.77788323149651e-23 - 4.333412423622383e-23im, 5.356561569940499e-24 + 1.0713123139881006e-23im, 0.0 + 0.0im, -5.356561569940499e-24 + 1.0713123139881006e-23im, -5.77788323149651e-23 + 4.333412423622383e-23im, -1.9525437127976443e-23 + 3.5500794778138974e-24im, 6.463350018037516e-23 + 1.8851437552609444e-23im, 5.548703412472947e-23 + 5.1427007237554135e-23im, 1.3465518043154768e-23 + 3.580603661475252e-23im, -1.1531945430871238e-24 + 1.105476148200761e-23im, -1.0324600168350196e-24 + 1.619364371643026e-24im, -1.5840076264880992e-25 + 9.485550257034661e-26im, -7.6232782938512e-27 + 5.798193054052366e-28im]
multipole_weights_2 = ComplexF64[0.0 + 0.0im, 0.0 + 0.0im, 1.0 + 0.0im, 0.0 + 0.0im, 0.0 + 0.0im, -0.005000000000000002 + 0.002500000000000001im, 0.015 + 0.0im, 0.005000000000000002 + 0.002500000000000001im, 0.0 + 0.0im, 0.0 + 0.0im, 1.2500000000000012e-5 - 1.6666666666666674e-5im, -0.00010000000000000006 + 5.000000000000003e-5im, 0.00010833333333333327 + 0.0im, 0.00010000000000000006 + 5.000000000000003e-5im, 1.2500000000000012e-5 + 1.6666666666666674e-5im, 0.0 + 0.0im, 0.0 + 0.0im, -1.0416666666666685e-8 + 5.7291666666666745e-8im, 2.812500000000002e-7 - 3.7500000000000017e-7im, -9.687500000000003e-7 + 4.843750000000001e-7im, 1.8749999999999924e-7 + 0.0im, 9.687500000000003e-7 + 4.843750000000001e-7im, 2.812500000000002e-7 + 3.7500000000000017e-7im, 1.0416666666666685e-8 + 5.7291666666666745e-8im, 0.0 + 0.0im, 0.0 + 0.0im, -3.645833333333341e-11 - 1.250000000000003e-10im, -2.500000000000002e-10 + 1.3750000000000007e-9im, 3.0625000000000018e-9 - 4.083333333333336e-9im, -5.2500000000000015e-9 + 2.6250000000000008e-9im, -3.7187500000000064e-9 + 0.0im, 5.2500000000000015e-9 + 2.6250000000000008e-9im, 3.0625000000000018e-9 + 4.083333333333336e-9im, 2.500000000000002e-10 + 1.3750000000000007e-9im, -3.645833333333341e-11 + 1.250000000000003e-10im, 0.0 + 0.0im, 0.0 + 0.0im, 1.6493055555555618e-13 + 1.7795138888888932e-13im, -9.114583333333346e-13 - 3.125000000000006e-12im, -2.907986111111119e-12 + 1.599392361111115e-11im, 2.0312500000000004e-11 - 2.7083333333333334e-11im, -1.1545138888888888e-11 + 5.772569444444444e-12im, -4.046875000000002e-11 + 0.0im, 1.1545138888888888e-11 + 5.772569444444444e-12im, 2.0312500000000004e-11 + 2.7083333333333334e-11im, 2.907986111111119e-12 + 1.599392361111115e-11im, -9.114583333333346e-13 + 3.125000000000006e-12im, -1.6493055555555618e-13 + 1.7795138888888932e-13im, 0.0 + 0.0im, 0.0 + 0.0im, -3.627232142857149e-16 - 1.3640873015873046e-16im, 4.241071428571445e-15 + 4.575892857142869e-15im, -1.1067708333333349e-14 - 3.7946428571428636e-14im, -2.12053571428572e-14 + 1.1662946428571454e-13im, 8.384486607142875e-14 - 1.1179315476190498e-13im, 5.6696428571428594e-14 - 2.8348214285714297e-14im, -2.146701388888889e-13 + 0.0im, -5.6696428571428594e-14 - 2.8348214285714297e-14im, 8.384486607142875e-14 + 1.1179315476190498e-13im, 2.12053571428572e-14 + 1.1662946428571454e-13im, -1.1067708333333349e-14 + 3.7946428571428636e-14im, -4.241071428571445e-15 + 4.575892857142869e-15im, -3.627232142857149e-16 + 1.3640873015873046e-16im, 0.0 + 0.0im, 0.0 + 0.0im, 5.386594742063502e-19 - 5.619109623015824e-20im, -9.521484375000029e-18 - 3.58072916666668e-18im, 5.308702256944467e-17 + 5.727810329861126e-17im, -8.544921875000009e-17 - 2.929687500000004e-16im, -1.045735677083335e-16 + 5.751546223958339e-16im, 1.618652343750001e-16 - 2.1582031250000004e-16im, 6.556260850694454e-16 - 3.278130425347227e-16im, -6.278366815476184e-16 + 0.0im, -6.556260850694454e-16 - 3.278130425347227e-16im, 1.618652343750001e-16 + 2.1582031250000004e-16im, 1.045735677083335e-16 + 5.751546223958339e-16im, -8.544921875000009e-17 + 2.929687500000004e-16im, -5.308702256944467e-17 + 5.727810329861126e-17im, -9.521484375000029e-18 + 3.58072916666668e-18im, -5.386594742063502e-19 - 5.619109623015824e-20im, 0.0 + 0.0im, 0.0 + 0.0im, -5.672932512125255e-22 + 3.6168981481481694e-22im, 1.4364252645502657e-20 - 1.4984292328042185e-21im, -1.2191530257936541e-19 - 4.584848985890667e-20im, 4.2607060185185297e-19 + 4.597077546296302e-19im, -4.610038097993824e-19 - 1.5805844907407403e-18im, -3.4071180555555596e-19 + 1.873914930555557e-18im, -4.425274884259278e-19 + 5.900366512345702e-19im, 3.1827670304232833e-18 - 1.5913835152116416e-18im, -2.716053688547128e-19 + 0.0im, -3.1827670304232833e-18 - 1.5913835152116416e-18im, -4.425274884259278e-19 - 5.900366512345702e-19im, 3.4071180555555596e-19 + 1.873914930555557e-18im, -4.610038097993824e-19 + 1.5805844907407403e-18im, -4.2607060185185297e-19 + 4.597077546296302e-19im, -1.2191530257936541e-19 + 4.584848985890667e-20im, -1.4364252645502657e-20 - 1.4984292328042185e-21im, -5.672932512125255e-22 - 3.6168981481481694e-22im, 0.0 + 0.0im, 0.0 + 0.0im, 3.8644834380511364e-25 - 6.453364404210751e-25im, -1.531691778273814e-23 + 9.765625000000024e-24im, 1.8718416728670722e-22 - 1.9526405939980042e-23im, -1.0065569196428603e-21 - 3.785342261904774e-22im, 2.4305168030754038e-21 + 2.6223997085813528e-21im, -1.783040364583333e-21 - 6.113281250000001e-21im, -5.453378182870358e-22 + 2.9993580005786955e-21im, -4.992327008928588e-21 + 6.656436011904783e-21im, 9.082360646081339e-21 - 4.5411803230406695e-21im, 7.142101469494068e-21 + 0.0im, -9.082360646081339e-21 - 4.5411803230406695e-21im, -4.992327008928588e-21 - 6.656436011904783e-21im, 5.453378182870358e-22 + 2.9993580005786955e-21im, -1.783040364583333e-21 + 6.113281250000001e-21im, -2.4305168030754038e-21 + 2.6223997085813528e-21im, -1.0065569196428603e-21 + 3.785342261904774e-22im, -1.8718416728670722e-22 - 1.9526405939980042e-23im, -1.531691778273814e-23 - 9.765625000000024e-24im, -3.8644834380511364e-25 - 6.453364404210751e-25im, 0.0 + 0.0im]

vector_to_expansion!(multipole_expansion, multipole_weights_1, 1, expansion_order)
vector_to_expansion!(multipole_expansion, multipole_weights_2, 2, expansion_order)

# preallocate containers
Hs_π2 = [1.0]
FastMultipole.update_Hs_π2!(Hs_π2, expansion_order)
Ts = zeros(FastMultipole.length_Ts(expansion_order))
eimϕs = zeros(2, expansion_order+2)
weights_tmp_1 = initialize_expansion(expansion_order, eltype(Ts))
weights_tmp_2 = initialize_expansion(expansion_order, eltype(Ts))
weights_tmp_3 = initialize_expansion(expansion_order, eltype(Ts))

# normalization
ζs_mag = zeros(FastMultipole.length_ζs(expansion_order))
FastMultipole.update_ζs_mag!(ζs_mag, 0, expansion_order)
ηs_mag = zeros(FastMultipole.length_ηs(expansion_order))
FastMultipole.update_ηs_mag!(ηs_mag, 0, expansion_order)

lamb_helmholtz = Val(true)
derivatives_switch = DerivativesSwitch(true,true,true)

# translate expansion
FastMultipole.multipole_to_local!(local_expansion, local_branch, multipole_expansion, branch, weights_tmp_1, weights_tmp_2, weights_tmp_3, Ts, eimϕs, ζs_mag, ηs_mag, Hs_π2, FastMultipole.M̃, FastMultipole.L̃, expansion_order, lamb_helmholtz)

# evaluate local expansion
Δx = x_target - local_branch.target_center
velocity_n_m = FastMultipole.initialize_velocity_n_m(expansion_order)
ϕ, v, vg = FastMultipole.evaluate_local(Δx, harmonics, velocity_n_m, local_expansion, expansion_order, lamb_helmholtz, derivatives_switch)

Δx = x_target - x_source
velocity = -cross(Δx, Γ) / norm(Δx)^3 / (4*pi)

Δx5 = norm(Δx)^5
g11 = -3*(-Γ[3]*Δx[2] + Γ[2] * Δx[3]) * Δx[1]^2 / Δx5
g12 = -Γ[3]/norm(Δx)^3 - 3*(-Γ[3]*Δx[2] + Γ[2]*Δx[3]) * Δx[2]^2 / Δx5
g13 = Γ[2]/norm(Δx)^3 - 3*(-Γ[3]*Δx[2]+Γ[2]*Δx[3]) * Δx[3]^2 / Δx5
g21 = Γ[3]/norm(Δx)^3 - 3*(Γ[3]*Δx[1]-Γ[1]*Δx[3]) * Δx[1]^2 / Δx5
g22 = -3*(Γ[3]*Δx[1] - Γ[1]*Δx[3]) * Δx[2]^2 / Δx5
g23 = -Γ[1]/norm(Δx)^3 - 3*(Γ[3]*Δx[1]-Γ[1]*Δx[3])*Δx[3]^2/Δx5
g31 = -Γ[2]/norm(Δx)^3 - 3*(-Γ[2]*Δx[1]+Γ[1]*Δx[2])*Δx[1]^2 / Δx5
g32 = Γ[1]/norm(Δx)^3 - 3*(-Γ[2]*Δx[1]+Γ[1]*Δx[2])*Δx[2]^2/Δx5
g33 = -3*(-Γ[2]*Δx[1]+Γ[1]*Δx[2])*Δx[3]^2 / Δx5
velocity_gradient = SMatrix{3,3}(g11,g21,g31,g12,g22,g32,g13,g23,g33) / (4*pi)

@test isapprox(velocity, v; atol=1e-11)
for i in 1:9
    @test isapprox(velocity_gradient[i], vg[i]; atol=1e-9)
end

end
